<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#">
  <head>
      <meta charset="utf8" />
      <title>Invadir um site Wordpress - métodos e exemplos - Codigo </title>
      <meta name="description" content="">
      <meta name="keywords" content="">
      <meta property="og:locale" content="en_US">
      <meta property="og:site_name" content="Invadir um site Wordpress - métodos e exemplos">
      <meta property="og:image" content="/media/hacker1.jpg">
      <!--<meta property="og:image:type" content="image/jpg">-->
      <meta property="og:url" content="/php/linux/hack/2014/09/16/wordpress-hack-vulnerabilidades.html">
      <meta property="og:title" content="Invadir um site Wordpress - métodos e exemplos">
      <meta property="og:description" content="">
    
      <link href="/css/bootstrap.css" rel="stylesheet">
      <script>
    
      window.fbAsyncInit = function() {
        FB.init({
          appId      : '175461699313531',
          xfbml      : true,
          version    : 'v2.1'
        });
      };

      var fbShare = function(url) {
        FB.ui({
          method: 'share',
          href: 'https://developers.facebook.com/docs/',
        }, function(response){

        });

      };
      

      (function(d, s, id){
         var js, fjs = d.getElementsByTagName(s)[0];
         if (d.getElementById(id)) {return;}
         js = d.createElement(s); js.id = id;
         js.src = "//connect.facebook.net/en_US/sdk.js";
         fjs.parentNode.insertBefore(js, fjs);
       }(document, 'script', 'facebook-jssdk'));
    

      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-41887317-1', 'auto');
      ga('send', 'pageview');
    </script>

    <link href="//fonts.googleapis.com/css?family=OpenSans:400,700" rel="stylesheet" type="text/css" />

      <style>
        body {
          padding-top: 60px;
          font-family: 'OpenSans';
          font-size: 16px;
        }
        .layout-footer {
          border-top:solid 1px #ddd;
          padding-top: 8px;
          margin-top: 20px;
          text-align: center;;
        }
        .post__thumbnail {
          max-width: 60px;
        }

        .media-date {
          float: right;
          color: #666666;
        }

        .post__list {
          border-bottom: solid 1px #CCCCCC;
          padding-bottom: 10px;
        }

        .post__list h4 a, .post__list h4 a:hover, .post__list h4 a:focus {
          text-decoration: none;
        }

        .post-entry__thumbnail {
          float: right;
          max-height: 75px;
        }

        .post-entry__image {
          max-width: 650px;
        }
        /*
         * syntax.css
         */
        .post > .highlight .lineno { color: #ccc; display:inline-block; padding: 0 5px; border-right:1px solid #ccc; }
        .post > .highlight pre code { display: block; white-space: pre; overflow-x: auto; word-wrap: normal; }

        /*
         * Bootstrap extensions
         * i'm too lazy on this one
         * latter i'll configure grunt and pass all to less
         */
         .navbar-default {
            background-color: #FFFFFF;
          }
      </style>
      <link href="/css/bootstrap-responsive.css" rel="stylesheet">
      <link href="/css/syntax.css" rel="stylesheet">
      <!--[if lt IE 9]>
        <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
      <![endif]-->
  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">Publicações</a>
    </div>
     <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li><a href="/feed.xml">RSS</a></li>
    </ul>
    </div>
    </div>
    </nav>
</div>

<div class="container" style="max-width: 1200px;">
  <div class="clearfix">
<h2 class="content">Invadir um site Wordpress - métodos e exemplos</h2>
</div>
 
<h3 id="verso">Versão</h3>

<p>Há vulnerabilidades conhecidas no código principal do Wordpress. Não são muitas mas andam aí e são fáceis de apanhar!</p>

<p>Para descubrires a versão do wordpress procura a tag <strong>generator</strong> na página retornada (ver código fonte do browser…).</p>

<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;generator&quot;</span> <span class="na">content=</span><span class="s">&quot;WordPress 3.9.2&quot;</span> <span class="nt">/&gt;</span></code></pre></div>

<p>A maioria das instalações contém o ficheiro readme.html que tem de ser removido depois de instalado o Wordpress. Também podemos ver a versão por aí.</p>

<p>O próximo passo é saber a versão dos plugins. Podemos fazer um método passivo e fazer pedidos http aos ficheiros do plugin que procuramos, podemos também ver a resposta do http se é 200 para existente ou 404 para não encontrado.</p>

<p>@todo - vou indicar alguns scripts com base de dados actualizadas que podemos usar para tornar o método aggressivo.</p>

<p>Daqui iremos usar vulnerabilidades para os plugins encontrados, mas isso mais à frente.</p>

<h3 id="utilizadores">Utilizadores</h3>

<p>O método que vamos seguir para atacar as contas vai ser brute force. Uma tentativa em massava de autenticação com várias passwords pré defenidas.
O Wordpress permite saber quem é cada utilizador pelo seu id</p>

<pre><code>http://guilhermecardoso.pt/?author=1 
</code></pre>

<p>Se estiver configurado para URLs amigáveis, o pedido retorna um redireccionamento indicando o nickname no url</p>

<pre><code>http://guilhermecardoso.pt/author/gui
</code></pre>

<p>Além do método de brute force há outras formas de obter as credências.
Se estiveres ligado na mesma rede que alguém que entre no site e tiveres a sorte de não ter nenhum certificado SSL um rastreio do pedido http indica o utilizador e password. Da mesma forma podem ser usados keyloggers mas ou o instalas no mesmo computador que a pessoa que vai aceder ao site, ou dentro da mesma rede usas um exploit para instalar o keylogger (redes públicas com WindowsXP e softwares como o Java e Internet Explorer desactualizados são indicadas).</p>

<p>De volta aos utilizadores, se te autenticares com um utilizador existente e uma password inválida o Wordpress é nosso amigo e avisa-nos que a conta existe.</p>

<p><img src="/media/posts/wordpress-hack1.png" class="img-responsive" /></p>

<h3 id="ferramentas">Ferramentas</h3>

<p>As ferramentas e scripts que aqui vou indicar são código aberto e é espetacular encontrá-las no github, só demonstra a verdadeira liberdade do opensource :)</p>

<h4 id="httpwpscanorg">http://wpscan.org/</h4>

<ul>
  <li>Login com brute force</li>
  <li>Análise de plugins e temas com vulnerabilidades conhecidas</li>
  <li>Indicar lista de utilizadores</li>
</ul>

<p>Um pequeno exemplo</p>

<pre><code>ruby wpscan.rb -u 192.241.xx.x68 --threads 20 --wordlist 500worst.txt --username testadmin

********* SNIP ******************

[+] Starting the password brute forcer

  Brute forcing user 'testadmin' with 500 passwords... 100% complete.
[+] Finished at Thu Jul 18 03:39:02 2013
[+] Elapsed time: 00:01:16
</code></pre>

<p>Admirado pelas 500 passwords num minuto e 16 segundos? Isto é numa VPS fraca na digital ocean que me custa 3.5 euros mensais. Servidores mais rápidos e infrastruturas maiores permitem-te resultados melhores. Em caso de ips bloqueados ou outras defesas que sejam aplicadas podes recorrer a uma rede: várias máquinas com uma lista curta de passwords a fazerem tentativas aleatórias para não serem bloqueadas por exemplo.</p>

<h4 id="nmap">Nmap</h4>

<p>Esta ferramenta aparece no Matrix! Ela não serve apenas para procurar portas abertas, diz-nos bastante mais que isso.</p>

<p>@todo mostrar exemplos de scripts ecs :)</p>

<h3 id="vulnerabilidades">Vulnerabilidades</h3>

<p>As vulnerabilidades que estas ferramentas e scripts utilizam são erros ou falhas existentes no código. Estes erros e falhas podem permitir:</p>

<ul>
  <li>Enviar uma shell para o servidor e aceder a ela (vai efectuar acções no servidor como compressão de directorios e enviar por ftp, descubrir passwords em ficheiros de configuração, etc). Esta vulnerabilidade é comum em anexo de uploads que não validam correctamente o pedido.</li>
  <li>Injecção de código SQL. URLs do gênero /wp-content/plugins/exemplo/ficheiro.php?id=3534 são usados para injectar código SQL, ou seja, substituir o id por algo que interpretado pela base de dados faça algo que não deveria. Isto ocorre também por má validação</li>
</ul>

<p>O problema destas vulnerabilidades é que são demasiado fáceis de ser descoberta por ser código aberto e todos temos acesso, até mesmo plugins pagos recebes o código (apenas tens de usar a licença para usar o plugin no site). O Wordpress tem uma comunidade enorme de programadores, uns melhores que os outros.
Há muitos temas excelentes a nível de design mas fracos na programação e que podem comprometer um servidor inteiro. Empresas que se baseam em “desenvolver” websites (não, CMS não é programar cara!) com CMS deste gênero correm estes riscos e a menos que não conheçam bem o terreno e saibam o que fazem, é comum perderem horas a fazer restauros por causa de plugins infectados.</p>

<div class="clearfix">
	  <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = ''; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
</div>

<div class="comments">
        <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'guilhermecardoso'; 
        
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> 
</div>

</div>
<div class="layout-footer">
<div class="container">
este site é livre - <a href="https://github.com/guilhermegeek/guilhermegeek.github.io">guilhermegeek.github.io</a> desenvolvido com <a href="http://jekyllrb.com">Jekyll</a><a href="https://plus.google.com/113360680720404654467" rel="publisher"></a>

</div>
</div>
</body>
</html>