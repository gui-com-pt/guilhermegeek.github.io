<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- saved from url=(0056)http://www.tonymarston.net/php-mysql/infrastructure.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>A Development Infrastructure for PHP</title>
  
	<meta name="author" lang="EN" content="Tony Marston">
	<meta name="description" content="A Development Infrastructure for PHP">
	<meta name="keywords" content="PHP, application infrastructure, development infrastructure, development environment, 3 tier architecture, mvc, model-view-controller">
<link rel="stylesheet" type="text/css" href="./A Development Infrastructure for PHP_files/document.css">
<style type="text/css">
	<!--
    .redborder { border: medium solid red; padding: 1em; }
	-->
	</style>
</head>
<body>

<div id="radicoreheader">
  <div id="radicorelogo">
  	<a href="http://www.radicore.org/" title="Radicore homepage">
      <img src="./A Development Infrastructure for PHP_files/radicore-logo.gif" title="Radicore" alt="Radicore" border="0">
    </a>
  </div>
  <div id="radicoretitle">
  	<h2>Rapid Application Development toolkit for building Administrative Web Applications</h2>
  </div>
</div>

<h1>RADICORE - A Development Infrastructure for PHP</h1>

<h2>By Tony Marston</h2>

<p>2nd August 2003<br>Amended 30th April 2012</p>

<p class="announce">As of 10th April 2006 the software discussed in this article is available as open source and can be downloaded from <a href="http://www.radicore.org/">www.radicore.org</a></p>

<dl id="index">
<dt><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#introduction">Introduction</a></dt>
<dt><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#background">- Background</a></dt>
<dt><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#3tier">The 3 Tier Architecture</a></dt>
<dt><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#data.access.layer">- Data Access layer</a></dt>
<dt><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#business.layer">- Business layer</a></dt>
<dt><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#presentation.layer">- Presentation layer</a></dt>
<dt><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#mvc">The Model-View-Controller (MVC) design pattern</a></dt>
<dt><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#model">- The Model component</a></dt>
<dt><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#view">- The View component</a></dt>
<dt><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#controller">- The Controller component</a></dt>

<dt><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#design">Infrastructure Design</a></dt>
<dt><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#forms-families">- Forms Families</a></dt>
<dt><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#structure-behaviour-content">- Structure, Behaviour, Content ...</a></dt>
<dt><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#style">- ... and Style</a></dt>

<dt><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#implementation">Infrastructure Implementation</a></dt>
<dt><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#component.script">- Component scripts</a></dt>
<dt><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#controller.script">- Transaction Pattern (Controller) scripts</a></dt>
<dt><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#generic.table.class">- Generic (abstract) Table class</a></dt>
<dt><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#table.class">- Database Table (Model) classes</a></dt>
<dt><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#validation.class">- Validation class</a></dt>
<dt><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#dml.class">- DML class</a></dt>
<dt><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#view.object">- View object</a></dt>
<dt><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#screen.structure">- Screen Structure scripts</a></dt>
<dt><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#xml.file">- XML files</a></dt>
<dt><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#xsl.stylesheet">- XSL Stylesheets</a></dt>
<dt><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#xsl.transformation">- XSL Transformation process</a></dt>
<dt><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#html.output">- HTML output</a></dt>
<dt><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#css.files">- CSS files</a></dt>
<dt><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#audit.class">- AUDIT class</a></dt>
<dt><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#workflow.engine">- Workflow Engine</a></dt>

<dt><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#reusability">Levels of Reusability</a></dt>
<dt><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#extensions">Extending this Infrastructure</a></dt>
<dt><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#references">References</a></dt>
<dt><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#history">Amendment History</a></dt>
</dl>

<h2><a name="introduction">Introduction</a></h2>

<p>With every programming language I have worked in it has become normal practice, after having developed an initial series of programs, to identify a common structure to which all subsequent programs should be built. This may take some time as it involves a bit of trial and error in playing with the different ways in which a task can be achieved in order to find the methodology that gives the most advantages in the long term. Eventually this development infrastructure/environment should contain the following:-</p>

<ul class="compress">
<li>A description as to how the user interfaces should be built so as to provide a consistent look and feel.</li>
<li>A list of naming conventions to identify how objects, functions and programs should be named.</li>
<li>A description of the directory structure used in the development environment so everybody knows where each type of object is supposed to be located.</li>
<li>A description of the strategies to be used when building programs.</li>
<li>A library of standard functions that can be used to perform common tasks.</li>
</ul>

<p>The list can be extended even further, but that will do as a starting point.</p>

<h3><a name="background">Background</a></h3>

<p>The PHP development environment that I have devised was created by taking a set of sample programs which I had assembled for a previous language and rewriting them in PHP. These sample programs were used as patterns or templates for all other programs in my applications as they represented all the combinations of structure and behaviour that I had encountered. To build a new component all I had to do was identify the right template, then specify which database tables(s) and columns I wished to show on the screen for the new component. Each database table was accessed via its own separate service component which contained all the business rules associated with that table plus the code to communicate with the database. As each user screen accessed each database table by its own service component it meant that business logic was shared and not duplicated. Both user screens and service components used shared code in the form of 'include' files, so it was possible to update the shared library and have the changes automatically picked up by the various components.</p>

<p>From the outset my aim was to produce an environment with the following characteristics:-</p>

<ul>
<li>To be based on the <a href="http://www.tonymarston.net/php-mysql/3-tier-architecture.html">3 Tier Architecture</a> so that the logic for the presentation layer, the business layer and the data access layer would be contained within separate components. This architecture allows the code within any one of the layers to be changed without affecting any of the other layers.</li>

<li>To make use of as many standard reusable scripts as possible. I have been long familiar with the advantages of having libraries of reusable subroutines and functions in other development languages, and my previous language, a 4th generation tool called UNIFACE, had the extra ability of components being able to inherit code from component templates.</li>

<li>To make use of the OO capabilities of PHP, but only where I saw an advantage in doing so. I do not believe OO is a universal panacea as any old problems which it claims to solve are counter-balanced by new problems which it creates. OOP techniques do not prevent errors, they simply create a new class of error.</li>
</ul>

<p>What I actually produced is as follows:-</p>

<ul>
<li>As I was familiar with <a href="http://www.w3.org/XML/">XML</a> and <a href="http://www.w3.org/Style/XSL/">XSL</a> before learning PHP, and because PHP already incorporates modules for those two disciplines, I chose to generate all HTML output via XML/XSL transformations. I did read about other templating engines that are available for PHP, but as these are written in PHP and tied to PHP I rejected them as I wanted something that was totally independent of the underlying language and preferably written to 'open' standards and therefore accessible to a larger community.</li>

<li>After building several screens with XSL stylesheets I identified a great deal of common code and moved it to a series of smaller XSL files which can be 'included' at runtime. Now when I build a stylesheet for a component it contains a large number of calls to my library of common templates.</li>

<li>All HTML output is written to <a href="http://www.w3.org/">W3C</a> standards and is therefore browser-independent. The output is actually <a href="http://www.w3.org/MarkUp/#recommendations">XHTML 1.0 Strict</a> with all formatting specified via <a href="http://www.w3.org/Style/CSS/">Cascading Style Sheets</a> (CSS). There is no JavaScript as this is not controlled by any <a href="http://www.w3.org/">W3C</a> standard and there are too many incompatibilities with its implementation between the different browsers. This decision allows the software to work as intended on any browser, the only condition being that the browser complies to <a href="http://www.w3.org/">W3C</a> standards. If anyone has a non-standard browser then any problems are theirs, not mine.</li>

<li>With UNIFACE I had successfully implemented the <a href="http://www.tonymarston.net/php-mysql/3-tier-architecture.html">3 Tier Architecture</a> by using service components in the middle layer, and as there are distinct similarities between 'components' and 'objects' (see <a href="http://www.tonymarston.net/php-mysql/databaseobjects.html#a4a">Using PHP Objects to access your Database Tables (Part 1)</a> for details) I found it very easy to build a class for each database table where previously I had used a service component. The ability for a component to inherit code from a component template was replaced by the ability for a class to inherit code from it's superclass.</li>

<li>In my first implementation I had a standard set of functions within my abstract database class which dealt with the creation and execution of all DML (Data Manipulation Language) statements. I have subsequently been able to extract all of those functions and place them in a class of their own, thus creating a totally separate DML object in the data access layer.</li>

<li>I have thus ended up with a 'true' 3 Tier structure as 
<ol class="compress">
<li>Only my data access layer has any form of communication with the database.</li>
<li>All business rules are processed by objects within the business layer.</li>
<li>All interfacing with the user is done by components within the presentation layer.</li>
<li>There is no direct communication between the presentation and data access layers. All communication is routed through the business layer.</li>
</ol>
</li>

<li>Although I had not intended to use the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#mvc">Model-View-Controller (MVC) design pattern</a> in my infrastructure (a previous encounter with someone else's disastrous implementation had not convinced me of any benefits), I later realised that what I had produced was a good fit to the MVC principles. It just goes to show that it is not what you implement but how you implement it that is important.</li>
</ul>

<p>Interestingly enough my decision to have all HTML output generated through XSL transformations instead of directly by PHP code actually paid enormous dividends by producing a great deal more reusable code than I had originally anticipated. I started by creating a script which performed an operation on a database table then wrote a second script to perform the same operation on a different table. I then compared the two scripts to see what was duplicated and could therefore be put into a sharable file, and what was different and which would have to remain in a script of its own. By careful engineering of the code I ended up with the situation where there were basically only two differences:</p>
<ul class="compress">
<li>The name of the database table to be accessed.</li>
<li>The name of the XSL file to be used to transform the output.</li>
</ul>

<p>I ended up with three types of PHP script in my presentation layer:</p>
<ul class="compress">
<li>Unique <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#component.script">Component scripts</a> which identify which <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#table.class">Model</a>, <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#screen.structure">View</a> and <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#controller.script">Controller</a> components to use.</li>
<li>Sharable <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#controller.script">Transaction Pattern (Controller) scripts</a> to carry out the communication with the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#business.layer">business layer</a> objects and which produce the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#html.output">HTML output</a>.</li>
<li><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#screen.structure">Screen structure scripts</a> which control how the output is displayed. Some of these can be shared by several components.</li>
</ul>

<p>When building the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#xsl.stylesheet">XSL stylesheets</a> I came across common code which I was able to move into separate files as XSL templates (subroutines). These templates can be accessed by any number of stylesheets using the <code>&lt;xsl:include&gt;</code> command. A later improvement meant that instead of having a separate XSL stylesheet for each screen where the field names and field labels were hard-coded I could use a much smaller number of generic stylesheets and have the list of field names and field labels supplied within the XML file. The type of HTML control to be used for each field is written to the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#xml.file">XML file</a> as a series of field attributes, and a standard XSL template uses these attributes to generate the correct HTML code.</p>

<hr>

<h2><a name="3tier">The 3 Tier Architecture</a></h2>

<p>Any piece of software can be subdivided into the following areas:</p>

<ul class="compress">
<li>Presentation logic = User Interface, displaying data to the user, accepting input from the user.</li> 
<li>Business logic = Business Rules, handles data validation and task-specific behaviour.</li> 
<li>Data Access logic = Database Communication, constructing SQL queries and executing them via the relevant API.</li>
</ul>

<p>If you put the code which deals with presentation logic (the generation of HTML documents), business logic (the processing of business rules) and data access logic (the generation and execution of DML (SQL) statements) into a single component then what you have is a single tier structure, as shown in <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#figure1">Figure 1</a>.</p>

<div class="center">
<p><a name="figure1">Figure 1</a> - 1 Tier architecture</p>
<img alt="infrastructure-01 (5K)" src="./A Development Infrastructure for PHP_files/infrastructure-01.png" height="268" width="528">
</div>

<p>If you split off all the code that handles the communication with the physical database to a separate component then you have a 2 tier architecture, as shown in <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#figure2">Figure 2</a>.</p>

<div class="center">
<p><a name="figure2">Figure 2</a> - 2 Tier architecture</p>
<img alt="infrastructure-02 (8K)" src="./A Development Infrastructure for PHP_files/infrastructure-02.png" height="268" width="528">
</div>

<p>If you go one step further and split the presentation logic from the business logic you have a 3 Tier Architecture, as shown in <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#figure3">Figure 3</a>. Note that there is no direct communication between the presentation and data access layers - everything must go through the business layer in the middle.</p>

<div class="center">
<p><a name="figure3">Figure 3</a> - 3 Tier Architecture</p>
<img alt="infrastructure-03 (8K)" src="./A Development Infrastructure for PHP_files/infrastructure-03.png" height="268" width="528">
</div>

<p>When this architecture is implemented the benefits will become apparent as more code can be shared instead of being duplicated. Several components in the presentation layer can share the same component in the business layer, and all components in the business layer share the same component in the data access layer. This is shown in <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#figure4">Figure 4</a>. Note also that a presentation layer component can access more than one business layer component, and a business layer component can access other business layer components.</p>

<div class="center">
<p><a name="figure4">Figure 4</a> - 3 Tier Architecture in operation</p>
<img alt="infrastructure-04 (8K)" src="./A Development Infrastructure for PHP_files/infrastructure-04.png" height="410" width="488">
</div>

<p>The big advantage of a 3-tier system is that it is possible to change the contents of any one of the tiers/layers without having to make corresponding changes in any of the others. For example:</p>

<ul class="compress">
<li>A change from one DBMS to another would only require a change to the component in the data access layer.</li>
<li>A change in the Use Interface, for example from desktop to the web, would only require changes to the components in the presentation layer.</li>
</ul>

<p>You should also notice here that the Business object is only responsible for assembling data in response to a request from the Presentation object. The Business object does not know or care what the Presentation object does with that data - it may build it into a compiled form, an HTML page, a PDF document, a CSV file, an XML file in response to a web service request, or whatever.</p>

<p>By having separate layers with different responsibilities this architecture also makes it possible to use different teams of developers to work on each. That means I can need PHP skills for the business layer, SQL skills for the data access layer, and (X)HTML, CSS and XSL skills for the presentation layer. It may be easier to find developers with skills in one of these areas rather than all three.</p>

<p>The environment which I have created is based on the 3-tier architecture, as shown in <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#figure5">Figure 5</a>.</p>

<div class="center">
<p><a name="figure5">Figure 5</a> - Environment/Infrastructure Overview</p>
<map name="structure">
<area href="http://www.tonymarston.net/php-mysql/infrastructure.html#component.script" title="Component Script" alt="Component Script" coords="313,62,412,111">
<area href="http://www.tonymarston.net/php-mysql/infrastructure.html#controller.script" title="Controller Script" alt="Controller Script" coords="313,149,412,198">
<area href="http://www.tonymarston.net/php-mysql/infrastructure.html#table.class" title="Database Table Class" alt="Database Table Class" coords="514,118,613,167">
<area href="http://www.tonymarston.net/php-mysql/infrastructure.html#generic.table.class" title="Abstract Table Class" alt="Abstract Table Class" coords="516,262,615,311">
<area href="http://www.tonymarston.net/php-mysql/infrastructure.html#validation.class" title="Validation Class" alt="Validation Class" coords="583,179,682,228">
<area href="http://www.tonymarston.net/php-mysql/infrastructure.html#dml.class" title="DML Class" alt="DML Class" coords="707,262,806,311">
<area href="http://www.tonymarston.net/php-mysql/infrastructure.html#screen.structure" title="Screen Structure Script" alt="Screen Structure Script" coords="360,290,459,339">
<area href="http://www.tonymarston.net/php-mysql/infrastructure.html#xml.file" title="XML file" alt="XML file" coords="313,369,412,418">
<area href="http://www.tonymarston.net/php-mysql/infrastructure.html#xsl.stylesheet" title="XSL Stylesheet" alt="XSL Stylesheet" coords="187,370,286,418">
<area href="http://www.tonymarston.net/php-mysql/infrastructure.html#xsl.transformation" title="XSL Transformation Process" alt="XSL Transformation Process" coords="193,290,299,339">
<area href="http://www.tonymarston.net/php-mysql/infrastructure.html#html.output" title="HTML Output" alt="HTML Output" coords="187,211,286,260">
<area href="http://www.tonymarston.net/php-mysql/infrastructure.html#css.files" title="CSS File" alt="CSS File" coords="187,124,286,173">
<area href="http://www.tonymarston.net/php-mysql/infrastructure.html#audit.class" title="Audit Class" alt="Audit Class" coords="706,369,805,418">
<area href="http://www.tonymarston.net/php-mysql/infrastructure.html#workflow.engine" title="Workflow Engine" alt="Workflow Engine" coords="514,370,613,419">
<area href="http://www.tonymarston.net/php-mysql/infrastructure.html#view.object" title="View Object" alt="View Object" coords="158,284,487,425">
<area href="http://www.tonymarston.net/php-mysql/infrastructure.html#presentation.layer" title="Presentation layer" alt="Presentation layer" coords="142,53,499,432">
<area href="http://www.tonymarston.net/php-mysql/infrastructure.html#business.layer" title="Business layer" alt="Business layer" coords="508,53,688,432">
<area href="http://www.tonymarston.net/php-mysql/infrastructure.html#data.access.layer" title="Data Access layer" alt="Data Access layer" coords="697,53,816,432">
</map>
<img usemap="#structure" src="./A Development Infrastructure for PHP_files/infrastructure-05.png" alt="infrastructure-05 (13K)" title="infrastructure-05 (13K)" height="441" width="831" border="0">
</div>

<p>The various components in <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#figure5">Figure 5</a> are described as follows:</p>

<ol class="compress">
<li><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#component.script">Component scripts</a></li>
<li><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#controller.script">Transaction Pattern (Controller) scripts</a></li>
<li><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#table.class">Database Table (Model) classes</a></li>
<li><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#generic.table.class">Generic (abstract) table class</a></li>
<li><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#validation.class">Validation class</a></li>
<li><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#dml.class">DML class</a></li>
<li><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#view.object">View Object</a></li>
<li><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#screen.structure">Screen Structure scripts</a></li>
<li><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#xml.file">XML files</a></li>
<li><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#xsl.stylesheet">XSL Stylesheets</a></li>
<li><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#xsl.transformation">XSL Transformation process</a></li>
<li><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#html.output">HTML output</a></li>
<li><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#css.files">CSS files</a></li>
<li><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#audit.class">AUDIT class</a></li>
<li><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#workflow.engine">Workflow Engine</a></li>
</ol>

<p>Note that this is proper <a href="http://www.tonymarston.net/php-mysql/3-tier-architecture.html">3-Tier Architecture</a>, not the pseudo variety as claimed by many who seem to think that the arrangement of web browser, web server and database automatically constitutes a 3 Tier system. It is the construction of the software in the middle that decides whether the system is 1, 2 or 3 Tier. It is only when a system has separate components to deal with the different areas of logic that it can be truly described as 3-tier.</p>

<p>The infrastructure described in this document has the following degrees of separation:-</p>

<h3><a name="data.access.layer">Data Access layer</a></h3>

<p>This is part of <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#figure3">3 Tier Architecture</a>. It consists of a one or more <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#dml.class">DML objects</a> which issue the functions to communicate with the physical database(s). There is a separate <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#dml.class">DML class</a> for each database engine (<a href="http://www.mysql.com/">MySQL</a>, <a href="http://www.postgresql.org/">PostgreSQL</a>, <a href="http://www.oracle.com/">Oracle</a>, <a href="http://www.microsoft.com/sqlserver/en/us/default.aspx">SQL Server</a>). This is sometimes referred to as a Data Access Object (DAO).</p>

<p>Not only is it possible within the same transaction to access tables in different databases, it is also possible to access tables through different database engines.</p>

<p>This layer also communicates my <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#audit.class">AUDIT class</a> in order to record all changes made to an application database in a separate 'audit' database so that they can be reviewed using online enquiry screens.</p>

<h3><a name="business.layer">Business layer</a></h3>

<p>This is part of <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#figure3">3 Tier Architecture</a>. It contains a separate <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#table.class">table class</a> for each database table or business entity. Each <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#table.class">table class</a> is a subclass of a <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#generic.table.class">generic table class</a> so that it can inherit as much generic code as possible.</p>

<p>All communication with the physical database is handled by the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#generic.table.class">generic table class</a> through a separate <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#dml.class">DML class</a>.</p>

<p>Primary data validation is handled by the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#generic.table.class">generic table class</a> through a <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#validation.class">validation class</a>. Secondary data validation is performed by customised functions within each <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#table.class">table class</a>.</p>

<p>This layer also communicates my <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#workflow.engine">Workflow Engine</a> in order to determine if a new workflow case needs to be created, and to progress each case through its various stages.</p>

<h3><a name="presentation.layer">Presentation layer</a></h3>

<p>This is part of <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#figure3">3 Tier Architecture</a>. It contains a separate <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#component.script">component script</a> for each transaction or task within the system. This is a simple mechanism which identifies which <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#model">model</a>, <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#view">view</a> and <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#controller">controller</a> components to use.</p>

<p>The <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#controller.script">controller script</a> handles the transaction behaviour.</p>

<p>The <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#table.class">database table class</a> (model) identifies the entity or entities which need to be accessed.</p>

<p>The controller performs operations on the model in order to change the state of the model.</p>

<p>The <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#view.object">view object</a> extracts data from the model, formats it, usually into <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#html.output">HTML</a>, and sends the result back to the client. There will be different view objects for alternative formats such as <a href="http://www.tonymarston.net/php-mysql/output-to-pdf.html">PDF</a> or CSV.</p>

<hr>

<h2><a name="mvc">The Model-View-Controller (MVC) design pattern</a></h2>

<p>It was some time after I had developed this infrastructure that I discovered that it also contained an implementation of the MVC design pattern. This is discussed in more detail in <a href="http://www.tonymarston.net/php-mysql/model-view-controller.html">The Model-View-Controller (MVC) Design Pattern for PHP</a>.</p>

<div class="center">
<p><a name="figure6">Figure 6</a> - The Model-View-Controller structure</p>
<img alt="infrastructure-06 (6K)" src="./A Development Infrastructure for PHP_files/infrastructure-06.png" height="378" width="727">
</div>

<h3><a name="model">The Model component</a></h3>

<p>A model is an object representing data or even an activity. In my infrastructure this is implemented as a series of <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#table.class">table classes</a>, one for each table in the database, which inherit a large amount of code from the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#generic.table.class">abstract table class</a>. Each class handles the data validation and business rules for a single database table, but note that all communication with the physical database is routed through a separate <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#dml.class">DML Object</a>, with a separate DML class for each supported DBMS engine.</p>

<h3><a name="view">The View component</a></h3>

<p>A view is some form of visualisation of the state of the model. In my infrastructure I can format and send data to the client in one of three possible formats:</p>

<ol>
<li><b>HTML</b> - This component is given two pieces of information: (a) a <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#screen.structure">screen structure script</a> which identifies which <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#xsl.stylesheet">XSL stylesheet</a> to use and which data elements go where on the screen, and (b) one or more <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#table.class">database table objects</a> which have already been filled with data. This component will then extract all the data from the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#table.class">database table object(s)</a> and write it out to an <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#xml.file">XML document</a>. Other data, such as the menu buttons, navigation buttons, pagination and scrolling details, action buttons, et cetera, is also added to the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#xml.file">XML document</a>, after which it is <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#xsl.transformation">transformed</a> into <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#html.output">HTML output</a>. For each database table there is typically a <a href="http://www.tonymarston.net/php-mysql/dialog-types.html#data-area.multiple">list view</a> (containing multiple occurrences with data arranged horizontally) and a <a href="http://www.tonymarston.net/php-mysql/dialog-types.html#data-area.single">detail view</a> (containing a single occurrence with data arranged vertically). The same <a href="http://www.tonymarston.net/php-mysql/dialog-types.html#data-area.single">detail view</a> can be used by the <a href="http://www.tonymarston.net/php-mysql/dialog-types.html#add1">ADD</a>, <a href="http://www.tonymarston.net/php-mysql/dialog-types.html#enquire1">ENQUIRE</a>, <a href="http://www.tonymarston.net/php-mysql/dialog-types.html#update1">UPDATE</a>, <a href="http://www.tonymarston.net/php-mysql/dialog-types.html#delete1">DELETE</a> and <a href="http://www.tonymarston.net/php-mysql/dialog-types.html#search1">SEARCH</a> screens.</li>

<li><b>PDF</b> - This component is given two pieces of information: (a) a <a href="http://www.tonymarston.net/php-mysql/output-to-pdf.html#report.structure.file">report structure script</a> which identifies which data elements go where on the report, and (b) a single <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#table.class">database table object</a> which has issued an SQL "select" statement. It will extract the data one row at a time, write it out to the PDF document, then read the next row.</li>

<li><b>CSV</b> - This component is given a single <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#table.class">database table object</a> which has issued an SQL "select" statement. It will extract the data one row at a time, write it out to the CSV document, then read the next row. The very first row of data is preceded by a list of the column names.</li>
</ol>

<h3><a name="controller">The Controller component</a></h3>

<p>A controller offers facilities to change the state of the model. It accepts input from the user and instructs the model to perform actions based on that input, then updates the view to show the results of those actions.</p>

<p>In my infrastructure this is implemented as a series of <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#component.script">component scripts</a> which link to one of a series of <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#controller.script">transaction pattern (controller) scripts</a></p>

<hr>

<h2><a name="design">Infrastructure Design</a></h2>

<p>Some of my approaches to infrastructure design are based on experiences which I have had in previous languages. It is encouraging to know that some of my design decisions as just as valid now as they were then. It just goes to show that quality is ageless.</p>

<h3><a name="forms-families">Forms Families</a></h3>

<p>Some designers have the peculiar notion that the complexity of a system is directly proportional to the number of components it contains, therefore they try to pack as many functions as possible into a single component. In order to maintain the contents of a typical database table it is usual to provide the following functionality:</p>

<ul class="compress">
<li>The ability to browse through all or selected occurrences (rows).</li>
<li>The ability to define selection criteria in order to retrieve selected occurrences.</li>
<li>The ability to create/insert new occurrences.</li>
<li>The ability to read/enquire the details of existing occurrences.</li>
<li>The ability to amend/update existing occurrences.</li>
<li>The ability to delete existing occurrences.</li>
</ul>

<p>It is possible to put all this functionality into a single component, but the end result is a very large, very complex component. If this approach is duplicated throughout the entire system the end result is a collection of very large, very complex components. In my experience the size of a component is directly proportional to the amount of effort needed to maintain it, so smaller is better.</p>

<p>The alternative approach, one which I first found to be successful when <a href="http://www.tonymarston.co.uk/cobol/">COBOL</a> was my primary language and which was just as successful when I switched to <a href="http://www.tonymarston.net/uniface/">UNIFACE</a>, is to provide each of these facilities in a separate component. This may produce a large number of components, but at least they are small and simple. The arguments for the 'small and simple' approach against the 'large and complex' are explored in more detail in my article <a href="http://www.tonymarston.net/uniface/largevssmall.html">Component Design - Large and Complex vs. Small and Simple</a>.</p>

<p>When I read that when designing components for web pages the 'small and simple' approach was preferred over the 'large and complex' this did not pose a problem for me as this has been my design philosophy for 20 years.</p>

<p>Now when I want to write software to maintain the contents of a typical database table I build a 'family' of small components where each one performs just one of the previously mentioned functions. This produces a family of components (sometimes referred to as forms or screens) with the structure shown in <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#figure7">Figure 7</a>. Each of these components has its own <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#controller.script">Transaction Pattern (Controller) script</a>.</p>

<div class="center">
<p><a name="figure7">Figure 7</a> - A typical Family of Forms</p>
<img alt="infrastructure-07 (1K)" src="./A Development Infrastructure for PHP_files/infrastructure-07.png" height="268" width="252">
</div>

<p>In this structure the LIST (parent) component is the only one that is available on a <a href="http://www.tonymarston.net/php-mysql/dialog-types.html#menu-bar">menu button</a> - all the other child components can only be selected from a <a href="http://www.tonymarston.net/php-mysql/dialog-types.html#navigation-bar">navigation button</a> within a suitable parent component. In most cases the child component will need the primary key of an occurrence in the parent component before it can load any data on which it is supposed to act. In this case the required occurrence in the parent screen must be marked as selected using the relevant checkbox before the hyperlink or control button for the child component is pressed.</p>

<p>Another difference between these components is that the LIST component shows multiple rows of details, one occurrence per row, whereas the others will show the details for a single occurrence. As the layout for the SEARCH, INSERT, UPDATE, DELETE and ENQUIRE screens is extremely similar I have managed to provide for their construction with a single XSL file. This means that for each database table I  only need 2 XSL files, as shown in <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#figure8">Figure 8</a>.</p>

<div class="center">
<p><a name="figure8">Figure 8</a> - XSL files required for a family of forms</p>
<img alt="infrastructure-08 (3K)" src="./A Development Infrastructure for PHP_files/infrastructure-08.png" height="323" width="291">
</div>

<p>This is made possible as one of the parameters used in the XSL transformation process is <code>$mode</code>. This is used within the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#xsl.stylesheet">XSL stylesheet</a> to determine if each field can be input/amended by the user or should be display only.</p>

<p>In my original infrastructure each database table required its own version of the <a href="http://www.tonymarston.net/xml-xsl/xml-and-xsl.html#s3.2">list.xsl</a> and <a href="http://www.tonymarston.net/xml-xsl/xml-and-xsl.html#s4.2">detail.xsl</a> files as the table, field names and field labels had to be hard-coded inside them, but I have since enhanced my XSL library so that a small number of generic stylesheets can be used for any number of database tables. This is documented in <a href="http://www.tonymarston.net/xml-xsl/reusable-xsl.html">Reusable XSL Stylesheets and Templates</a> and uses updated versions of my <a href="http://www.tonymarston.net/xml-xsl/reusable-xsl.html#std.list1.xsl">std.list1.xsl</a> and <a href="http://www.tonymarston.net/xml-xsl/reusable-xsl.html#std.detail1.xsl">std.detail1.xsl</a> stylesheets which allow the table name(s), field names and field labels to be passed in as part of the <a href="http://www.tonymarston.net/xml-xsl/reusable-xsl.html#screen.structure.xml">XML data</a>.</p>

<h3><a name="structure-behaviour-content">Structure, Behaviour, Content ...</a></h3>

<p>In my long career as a software engineer I have written countless hundreds of components, and many times I have come across the situation where I have been asked to create a new component which is "just like that one, but which works on this set of data". In this situation it is necessary to identify those parts of the original component which can be reused 'as is' and those parts which have to be altered. In order to do this I break down each component into the following areas:</p>

<ul class="compress">
<li>Structure - how many tables or objects it deals with, arranged in different areas or zones, and how they are arranged in relation to one another.</li>
<li>Behaviour - what action it performs, such as listing  multiple rows, or creating/reading/updating/deleting a single row.</li>
<li>Content - which database table(s) and field(s) does it deal with.</li>
</ul> 

<p>The trick now is to make different templates or patterns based on a particular combination of structure and behaviour so that when you build a component from a template all you have to do is specify the content. No two languages provide the same method of creating reusable templates, so what works in one particular language may be totally impossible in another. With PHP the method I have devised is to produce scripts in two categories - <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#screen.structure">Screen Structure scripts</a> which identify the content and reusable <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#controller.script">Transaction Pattern (Controller) scripts</a> which deal with the structure and behaviour.</p>

<h3><a name="style"> ... and Style</a></h3>

<p>A feature of <a href="http://www.w3.org/MarkUp/">HTML documents</a> is that the visual presentation of each page can be altered quite easily. By 'visual presentation' I mean any of the following:</p>

<ul class="compress">
<li>Fonts - different parts of the page can use different fonts of different sizes.</li>
<li>Colours - different parts of the page can use different foreground and/or background colours.</li>
<li>Images - background colours can be replaced by background images.</li>
<li>Positioning - elements of a page may be positioned using either absolute or relative co-ordinates.</li>
</ul>

<p>Although it is possible to include all style specifications within an <a href="http://www.w3.org/MarkUp/">HTML document</a> it is not considered to be good practice. The most efficient method is to extract all style specifications and keep them in a separate <a href="http://www.w3.org/Style/CSS/">Cascading Style Sheet</a> (CSS) file or files. In this way it is possible to update the contents of a single CSS file and have that change automatically inherited by all the pages which reference the styles defined within that CSS file. Without the use of a CSS file it would be necessary to update each page individually, which on a large site could be a long and laborious process.</p>

<p>The term 'cascading' means that an HTML document can actually refer to a series of CSS files. These files will be scanned in the order in which they were defined and their contents merged so that a single specification is the result. In my infrastructure I use several <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#css.files">CSS files</a></p>

<hr>

<h2><a name="implementation">Infrastructure Implementation</a></h2>

<p>Although this infrastructure appears to be quite complex due to the large number of components, each component is responsible for just a small area and is therefore relatively simple. The trick is to know which components have to be created by the developer, which components have already been written and are available for immediate use, and how they all hang together.</p>

<h3><a name="component.script">Component scripts</a></h3>

<p>This is item (1) in <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#figure5">Figure 5</a>.</p>

<p>There is one of these for each task (user transaction) within the application. Each task has an entry on the <a href="http://www.tonymarston.net/php-mysql/menuguide/section04.html#task">MNU_TASK table</a> in the <a href="http://www.tonymarston.net/php-mysql/menuguide/section04.html">MENU database</a> so that it can be identified on the <a href="http://www.tonymarston.net/php-mysql/menuguide/section04.html#role-task">ROLE-TASK</a> table (access control list) and made to appear on either a <a href="http://www.tonymarston.net/php-mysql/menuguide/section04.html#menu">menu bar</a> or a <a href="http://www.tonymarston.net/php-mysql/menuguide/section04.html#navigation-button">navigation bar</a>.</p>

<p>This component is an implementation of the <a href="http://martinfowler.com/eaaCatalog/transactionScript.html">Transaction Script</a> pattern from Martin Fowler's <a href="http://martinfowler.com/eaaCatalog/">Patterns of Enterprise Application Architecture (PoEAA)</a>.</p>

<p>Each script in this category simply specifies the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#model">Model</a> and <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#view">View</a> before handing control over to a particular <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#controller">Controller</a>.</p>

<p>The component script for a transaction is automatically created when that transaction is <a href="http://www.tonymarston.net/php-mysql/data-dictionary.html#generate.scripts">generated</a> from the <a href="http://www.tonymarston.net/php-mysql/data-dictionary.html">Data Dictionary</a>.</p>

<p>Sample scripts for each pattern can be found in the <code>/radicore/default/</code> directory.</p>

<p>Here is an example of one of my scripts:</p>

<pre>&lt;?php
<span class="default">$table_id</span> = <span class="string">"person"</span>;                      <span class="comment">// identify the Model</span>
<span class="default">$screen</span>   = <span class="string">'person.detail.screen.inc'</span>;    <span class="comment">// identify the View</span>
require <span class="string">'std.enquire1.inc'</span>;                <span class="comment">// activate the Controller</span>
?&gt;
</pre>

<p>As you can see this is a simple script whose purpose is to identify the following:</p>

<ol class="compress">
<li><code>$table_id</code> identifies the Model part of <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#mvc">MVC</a>. This is one of the generated <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#table.class">database table classes</a>.</li>
<li><code>$screen</code> identifies the View part of <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#mvc">MVC</a>. This is one of the generated <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#screen.structure">screen structure scripts</a>.</li>
<li><code>include</code> identifies the Controller part of <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#mvc">MVC</a>. This is one of the pre-written <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#controller.script">controller scripts</a>.</li>
</ol>

<h3><a name="controller.script">Transaction Pattern (Controller) scripts</a></h3>

<p>This is item (2) in <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#figure5">Figure 5</a>.</p>

<p>This can also be referred to as a Transaction Controller or a Page Controller.</p>

<p>Each controller script contains the code to perform a particular action on an unspecified database table. For example:</p>

<ul class="compress">
<li>The <a href="http://www.tonymarston.net/php-mysql/dialog-types.html#list1">LIST1</a> controller will allow the user to browse the contents of a database table.</li>
<li>The <a href="http://www.tonymarston.net/php-mysql/dialog-types.html#search1">SEARCH1</a> controller will allow the user to specify selection criteria which will be used by the LIST transaction to filter its results.</li>
<li>The <a href="http://www.tonymarston.net/php-mysql/dialog-types.html#add1">ADD1</a> controller will allow the user to add a record.</li>
<li>The <a href="http://www.tonymarston.net/php-mysql/dialog-types.html#enquire1">ENQUIRE1</a> controller will allow the user to view the contents of a selected record.</li>
<li>The <a href="http://www.tonymarston.net/php-mysql/dialog-types.html#update1">UPDATE1</a> controller will allow the user to update the contents of a selected record.</li>
<li>The <a href="http://www.tonymarston.net/php-mysql/dialog-types.html#delete1">DELETE1</a> controller will allow the user to delete a selected record.</li>
</ul>

<p>For a full list of my Transaction Patterns please refer to <a href="http://www.tonymarston.net/php-mysql/dialog-types.html">Transaction Patterns for Web Applications</a>.</p>

<p>Each script in this category is based on a particular combination of <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#structure-behaviour-content">structure</a> and <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#structure-behaviour-content">behaviour</a>. The actual <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#structure-behaviour-content">content</a> is identified by the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#screen.structure">Screen Structure script</a> which is set in the calling <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#component.script">Component script</a>. This means that one of these Controller scripts may be called by many different <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#component.script">Component scripts</a>, as shown in <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#figure9">Figure 9</a>.</p>

<div class="center">
<p><a name="figure9">Figure 9</a> - Many Component scripts to one Transaction Pattern (Controller) script</p>
<img alt="infrastructure-09 (2K)" src="./A Development Infrastructure for PHP_files/infrastructure-09.png" height="212" width="323">
</div>

<p>None of these Controller scripts outputs any <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#html.output">HTML output</a> directly. This is done by the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#view.object">view object</a> which creates an <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#xml.file">XML file</a> containing all the relevant data, which is then <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#xsl.transformation">transformed into HTML</a> using a separate <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#xsl.stylesheet">XSL stylesheet</a>.</p>

<p>Here is an example of one of my scripts:</p>

<pre>&lt;?php
<span class="comment">// name = std.enquire1.inc</span>

<span class="comment">// type = enquire1</span>

<span class="comment">// This will display a single selected database occurrence using $where
// (as supplied from the previous screen)</span>

require <span class="string">'include.general.inc'</span>;

<span class="comment">// identify mode for xsl file</span>
<span class="default">$mode</span> = <span class="string">'enquire'</span>;

<span class="comment">// initialise session</span>
initSession();

<span class="comment">// look for a button being pressed</span>
if (<span class="default">$_SERVER</span>[<span class="string">'REQUEST_METHOD'</span>] == <span class="string">'POST'</span>) {
   if (isset(<span class="default">$_POST</span>[<span class="string">'finish'</span>]) or (isset(<span class="default">$_POST</span>[<span class="string">'finish_x'</span>]))) {
      <span class="comment">// cancel this screen, return to previous screen</span>
      scriptPrevious();
   } <span class="comment">// if</span>
} <span class="comment">// if</span>

<span class="comment">// create a class instance for the main database table</span>
require <span class="string">"classes/<span class="default">$table_id</span>.class.inc"</span>;
<span class="default">$dbobject</span> = new <span class="default">$table_id</span>;

<span class="default">$dbobject</span>-&gt;sql_select  = &amp;<span class="default">$sql_select</span>;
<span class="default">$dbobject</span>-&gt;sql_from    = &amp;<span class="default">$sql_from</span>;
<span class="default">$dbobject</span>-&gt;sql_where   = &amp;<span class="default">$sql_where</span>;
<span class="default">$dbobject</span>-&gt;sql_groupby = &amp;<span class="default">$sql_groupby</span>;
<span class="default">$dbobject</span>-&gt;sql_having  = &amp;<span class="default">$sql_having</span>;
<span class="comment">// check that primary key is complete</span>
<span class="default">$dbobject</span>-&gt;checkPrimaryKey = TRUE;

<span class="comment">// define action buttons</span>
<span class="default">$act_buttons</span>[<span class="string">'finish'</span>] = <span class="string">'FINISH'</span>;

<span class="comment">// retrieve profile must have been set by previous screen</span>
if (empty(<span class="default">$where</span>)) {
   scriptPrevious(<span class="string">'Nothing has been selected yet.'</span>);
} <span class="comment">// if</span>
   
<span class="comment">// get data from the database</span>
<span class="default">$fieldarray</span> = <span class="default">$dbobject</span>-&gt;getData(<span class="default">$where</span>);
   
if (<span class="default">$dbobject</span>-&gt;getErrors()) {
   <span class="comment">// some sort of error - return to previous script</span>
   scriptPrevious(<span class="default">$dbobject</span>-&gt;getErrors());
} <span class="">// if</span>
	
<span class="comment">// check number of rows returned</span>
if (<span class="default">$dbobject</span>-&gt;getNumRows() &lt; <span class="string">1</span>) {
   scriptPrevious(<span class="string">'Nothing retrieved from the database.'</span>);
} <span class="comment">// if</span>

<span class="comment">// use contents of first row only</span>
<span class="default">$fieldarray</span> = <span class="default">$fieldarray</span>[<span class="string">0</span>];
   
<span class="comment">// rebuild selection using primary key of retrieved row</span>
<span class="default">$where</span> = array2where(<span class="default">$fieldarray</span>, <span class="default">$dbobject</span>-&gt;getPkey());

<span class="comment">// get any extra data and merge with $fieldarray</span>
<span class="default">$fieldarray</span> = array_merge(<span class="default">$fieldarray</span>, <span class="default">$dbobject</span>-&gt;getExtraData(<span class="default">$fieldarray</span>));
	
<span class="comment">// build list of objects for output to XML data</span>
<span class="default">$xml_objects</span>[][<span class="string">'root'</span>] = &amp;<span class="default">$dbobject</span>;

<span class="comment">// build XML document and perform XSL transformation</span>
<span class="default">$view</span> = new radicore_view(<span class="default">$screen_structure</span>);
<span class="default">$view</span>-&gt;buildXML(<span class="default">$xml_objects</span>, <span class="default">$errors</span>, <span class="default">$message</span>);

?&gt;
</pre>

<p>Please note the following points:</p>

<ul>
<li>All files containing classes for database tables are in the format '&lt;table_id&gt;.class.inc', so all the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#component.script">Component script</a> need do is supply a value for <code>$table_id</code> and the Controller script can create an object from that class.</li>

<li>By setting the object variable <code>checkPrimaryKey</code> to TRUE I will trigger the code to check that the <code>$where</code> string contains values for all fields which make up the primary key for this database table. The primary key details are specified in the <a href="http://www.tonymarston.net/php-mysql/data-dictionary.html#$fieldspec">$fieldspec</a> array.</li>

<li>Each database table class contains a standard <code>getData</code> method which returns the <code>$fieldarray</code> array of rows (starting at row zero), and each row contains an associative array of <code>fieldname=fieldvalue</code> pairs.</li>

<li>By default the <code>getData</code> method will select all columns from the specified table, but this can be altered to specify any number of columns from any number of tables by settings in the <code>$sql_???</code> variables.</li>

<li>The entire contents of <code>$fieldarray</code> will be output to the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#xml.file">XML file</a>. Note that no field names need be specified in the script as they are all extracted from <code>$fieldarray</code>.</li>

<li>The <a href="http://www.tonymarston.net/php-mysql/data-dictionary.html#$fieldspec">$fieldspec</a> array from the database object may contain entries which will be included in the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#xml.file">XML output</a> as <a href="http://www.tonymarston.net/php-mysql/domxml.html#a5">attributes</a> in order to affect the outcome of the XSL transformation. For example <code>noedit</code> will cause a field to be read-only, while <code>nodisplay</code> will cause the field to be excluded from the HTML output altogether.</li>
</ul>

<p>Here is a brief explanation of my user-defined functions which are contained within file <a name="include.inc"><code>include.inc</code></a>:</p>

<ul>
<li><code>initSession()</code> - carries out all processing required when a script starts. This includes reading the session data to obtain the contents of the variable <code>$where</code> which contains any selection criteria passed down from the previous script.</li>

<li><code>scriptPrevious()</code> - will return processing to the previous script with an optional error message. Note that this is not the same as pressing the browser's <code>back</code> button.</li>

<li><code>array2where()</code> - transforms an associative array into a string which can be used as the WHERE clause in an SQL SELECT statement. The first parameter is the array, the optional second parameter identifies the subset of fields to be included.</li>

<li><code>$view-&gt;buildXML()</code> - takes the <code>$xml_objects</code> array and transfers all the data to an <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#xml.file">XML file</a>, after which it will perform the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#xsl.transformation">XSL Transformation</a> process using the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#xsl.stylesheet">XSL stylesheet</a> which was specified in the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#screen.structure">screen structure script</a> to produce the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#html.output">HTML output</a>.</li>
</ul>

<p>You should notice that the above script does not contain any hard-coded database, table or field names, therefore it can be used for any database table within the system. The points to consider are:</p>

<ul>
<li>The name of the table to work on is passed down in the <code>$table</code> variable which is set by the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#component.script">component script</a>.</li>
<li>That variable name is used to obtain a class definition from an 'include' file, and an object is instantiated from that class with a generic name, which in this case is <code>$object</code>.</li>
<li>The controller communicates with the object using standard method names which are common to all objects as they are inherited from the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#generic.table.class">generic table class</a>.</li>
<li>The data which comes out of the database object is a standard associative array of <code>fieldname=fieldvalue</code> pairs. This is extracted by the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#view.object">view object</a> and transferred to the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#xml.file">XML file</a> in an equivalent <code>fieldname=fieldvalue</code> format.</li>
</ul>

<p>I have some controller scripts which work on more than one database object, such as when dealing with a parent-child relationship or a many-to-many relationship, but the principles are exactly the same.</p>

<h3><a name="generic.table.class">Generic (abstract) table class</a></h3>

<p>This is item (4) in <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#figure5">Figure 5</a>.</p>

<p>This is an abstract class which is based on the ideas outlined in <a href="http://www.tonymarston.net/php-mysql/databaseobjects.html">Using PHP Objects to access your Database Tables (Part 1)</a> and <a href="http://www.tonymarston.net/php-mysql/databaseobjects2.html">(Part 2)</a>. It is called an 'abstract' class as it does not contain any implementation details and therefore cannot be instantiated into an object. Implementation details for each physical database table are supplied in separate <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#table.class">subclasses</a>, and it is only these subclasses that can be instantiated into objects.</p>

<p>This abstract database class contains generic methods and properties which can be used by any database table in the system. These methods and properties are automatically inherited by every <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#table.class">subclass</a>. Code which is specific to any particular table must be built into in the subclass for that particular table.</p>

<p>This generic class also contains the following:</p>

<ul>
<li>It contains the <a name="standard.methods">standard methods</a> and properties which are accessed by the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#controller.script">Transaction Pattern (Controller) scripts</a>. Amongst these are:
  <ul>
  <li><b><a name="getdata">getData</a> ($where)</b> - will retrieve any number of records from the database using the specified WHERE criteria. The sql SELECT statement will be constructed automatically from variables supplied at runtime. The result is an associative array of 'name=value' pairs, indexed by row number.</li>

  <li><b>insertRecord ($fieldarray)</b> - will insert a single row using the contents of <code>$fieldarray</code>, which is an associative array of 'name=value' pairs. The sql INSERT statement will be constructed automatically from the contents of <code>$fieldarray</code>.</li>

  <li><b>updateRecord ($fieldarray)</b> - will update a single row using the contents of <code>$fieldarray</code>, which is an associative array of 'name=value' pairs. The sql UPDATE statement will be constructed automatically from the contents of <code>$fieldarray</code>.</li>

  <li><b>deleteRecord ($fieldarray)</b> - will delete a single row using the contents of <code>$fieldarray</code>, which is an associative array of 'name=value' pairs. The sql DELETE statement will be constructed automatically from the contents of <code>$fieldarray</code>.</li>
  </ul>
	<p>Note that all communication with the physical database is performed within the relevant <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#dml.class">DML class</a>.</p>
</li>

<li>It passes the input array (usually the <code>$_POST</code> array) to the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#validation.class">validation class</a> for all input and update operations. Error messages are returned in the <code>$errors</code> array</li>

<li>During a delete operation it will use the contents of the <a href="http://www.tonymarston.net/php-mysql/data-dictionary.html#$child_relations">$child_relations</a> array to check that the record can be deleted and to update/delete all records from child tables if necessary.</li>

<li>It also contains a series of empty <a href="http://www.tonymarston.net/php-mysql/functions-and-variables.html#_cm_method">customisable methods</a> which are accessed in set places within the processing cycle. These can be replaced in a subclass with versions that contains custom code, and at runtime the customised method in the subclass will be executed instead of the empty method in the superclass.</li>
</ul>

<h3><a name="table.class">Database Table (Model) classes</a></h3>

<p>This is item (3) in <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#figure5">Figure 5</a>.</p>

<p>Each database table (or business entity) is represented by its own class which extends (is a subclass of) the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#generic.table.class">generic table class</a>.</p>

<p>This component is an implementation of the <a href="http://martinfowler.com/eaaCatalog/tableModule.html">Table Module</a> pattern from Martin Fowler's <a href="http://martinfowler.com/eaaCatalog/">Patterns of Enterprise Application Architecture (PoEAA)</a>. It also serves as the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#model">Model</a> in the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#mvc">Model-View-Controller</a> design pattern.</p>

<p>Although each table subclass will inherit all the generic code from the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#generic.table.class">superclass</a>, in order to be usable it must also contain information which is specific to the database table to which it relates. This information is as follows:</p>

<ul>
<li><a href="http://www.tonymarston.net/php-mysql/data-dictionary.html#table.class.inc">class constructor</a> - this defines the basic settings for the table such as:
  <ul class="compress">
  <li>database name</li>
  <li>table name</li>
  <li>The <a href="http://www.tonymarston.net/php-mysql/data-dictionary.html#$fieldspec">$fieldspec</a>, <a href="http://www.tonymarston.net/php-mysql/data-dictionary.html#$unique_keys">$unique_keys</a>,  <a href="http://www.tonymarston.net/php-mysql/data-dictionary.html#$parent_relations">$parent_relations</a> and <a href="http://www.tonymarston.net/php-mysql/data-dictionary.html#$child_relations">$child_relations</a> arrays (see below)</li>
  </ul>
</li>

<li><a href="http://www.tonymarston.net/php-mysql/data-dictionary.html#$fieldspec">$fieldspec</a> array - this identifies each field (column) in the table, and for each field it describes its characteristics (type, size, et cetera) so that primary validation can be performed via the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#validation.class">validation class</a> when inserting or updating records. This array also contains information which is used by the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#xsl.transformation">XSL transformation process</a> to identify what control (text box, dropdown list, radio group, etc) should be used for each field in the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#html.output">HTML output</a>.</li>

<li><a href="http://www.tonymarston.net/php-mysql/data-dictionary.html#$primary_key">$primary_key</a> array - used to define the field(s) which provide the primary means of uniquely identifying each record in a table. Most databases do not allow primary keys to be changed, so they must be validated during insert only.</li>

<li><a href="http://www.tonymarston.net/php-mysql/data-dictionary.html#$unique_keys">$unique_keys</a> array - used to enable the validation of candidate keys (optional unique keys in addition to the primary key). Unlike the primary key a candidate key can be changed, so it must be validated during both insert and update.</li>

<li><a href="http://www.tonymarston.net/php-mysql/data-dictionary.html#$parent_relations">$parent_relations</a> array - this identifies any parent tables which are related to this table in a parent-child (one-to-many) relationship. This is used when any data from the parent table needs to be added to the query result. The framework is capable of adding in the necessary JOIN clause when the query is constructed.</li>

<li><a href="http://www.tonymarston.net/php-mysql/data-dictionary.html#$child_relations">$child_relations</a> array - this identifies any child tables which are related to this table in a parent-child (one-to-many) relationship. This is used when any record is deleted to enforce basic referential integrity.</li>

<li><a href="http://www.tonymarston.net/php-mysql/databaseobjects2.html#custom.processing">custom processing</a> - within the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#generic.table.class">generic table class</a> are a series of <a href="http://www.tonymarston.net/php-mysql/functions-and-variables.html#_cm_method">abstract methods</a> which exist in the processing flow but which are empty of any code. Versions containing custom code can be created in each subclass which at runtime will replace the empty abstract methods in the superclass. These abstract methods provide the ability to perform custom processing, such as for the implementation of business rules, at predetermined places in the standard processing flow or to carry out <a href="http://www.tonymarston.net/php-mysql/infrastructure-faq.html#faq13">secondary data validation</a> which cannot be performed by the generic <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#validation.class">validation class</a>.</li>
</ul>

<p>Note that this class can deal with any number of database rows - I do not have one version to deal with a single row and a second version to deal with a collection of rows.</p>

<p>The class file for each database table does not have to be generated by hand - with the introduction of <a href="http://www.tonymarston.net/php-mysql/data-dictionary.html">A Data Dictionary for PHP Applications</a> it is possible to <a href="http://www.tonymarston.net/php-mysql/menuguide/dict_column(add4)import.html">import</a> the table structures directly from the database schema into the data dictionary, then to <a href="http://www.tonymarston.net/php-mysql/menuguide/dict_table(upd4)export.html">export</a> those structures into files which can be accessed directly by the application code.</p>

<h3><a name="validation.class">Validation class</a></h3>

<p>This is item (5) in <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#figure5">Figure 5</a>.</p>

<p>The generic validation class handles primary validation (sometimes referred to as declarative checking) of all user input. It compares the contents of the input array with the contents of the <a href="http://www.tonymarston.net/php-mysql/data-dictionary.html#$fieldspec">$fieldspec</a> array to check that the input data for each field conforms to that field's specifications. It puts any error messages in the current object's <code>$errors</code> array.</p>

<p>The input array (usually the <code>$_POST</code> array) is an array of <code>fieldname=fieldvalue</code> pairs.</p>

<p>The <a href="http://www.tonymarston.net/php-mysql/data-dictionary.html#$fieldspec">$fieldspec</a> array is an array of <code>fieldname=fieldspec</code> pairs. The <code>fieldspec</code> portion is another associative array of <code>keyword=value</code> pairs.</p>

<p>The <code>$errors</code> array is an array of <code>fieldname=errormsg</code> pairs. It can therefore contain error messages for any number of fields.</p>

<p>Primary validation is limited to the following checks:</p>

<ul class="compress">
<li>That all required fields have a non-null value.</li>
<li>That fields do not exceed their maximum size.</li>
<li>That date fields contain valid dates.</li>
<li>That time fields contain valid times.</li>
<li>That numeric fields contain valid numbers, with options for minimum/maximum values and number of decimal places.</li>
<li>A string field may have an optional subtype of <code>email_address</code> which causes the string to be checked against the relevant pattern.</li>
<li>A string field may have an optional subtype of <code>file</code> which causes a check to ensure that a file with that name exists.</li>
</ul>

<p><a href="http://www.tonymarston.net/php-mysql/infrastructure-faq.html#faq12">Secondary validation</a>, such as comparing one field against another, must be defined within the individual <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#table.class">table subclass</a> using the empty classes provided in the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#generic.table.class">superclass</a>.</p>

<p>It is also possible to supplement the generic validation with the addition of plug-ins, as described in <a href="http://www.tonymarston.net/php-mysql/custom-validation.html">Extending the Validation class</a>.</p>

<h3><a name="dml.class">DML class</a></h3>

<p>This is item (6) in <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#figure5">Figure 5</a>.</p>

<p>This is the only object in the system which carries out any communication with the physical database. It receives requests from the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#generic.table.class">Generic Table class</a> from which it generates the appropriate DML (Data Manipulation Language) or SQL (Structured Query Language) commands. It then executes these commands by calling the relevant API for the database in question.</p>

<p>This component is an implementation of the <a href="http://martinfowler.com/eaaCatalog/gateway.html">Gateway</a> pattern from Martin Fowler's <a href="http://martinfowler.com/eaaCatalog/">Patterns of Enterprise Application Architecture (PoEAA)</a>. As it exists in the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#data.access.layer">Data Access</a> layer it can also be referred to as the <a href="http://en.wikipedia.org/wiki/Data_access_object">Data Access Object (DAO)</a>. </p>

<p>There is a separate class for each database engine as each engine has its own set of APIs. This design also allows me to isolate and deal with any differences between the various engines. The name of the class file is in the format <code>dml.???.class.inc</code> where '<code>???</code>' can be <code>MySQL</code>, <code>PostgreSQL</code>, <code>Oracle</code>, <code>SQL Server</code> or whatever. The CONFIG.INC file identifies which database engine is to be used for which database. Although it is usual to have all the databases within a single server instance, it is also possible to have those databases spread across multiple servers on different IP addresses, or even different database engines. It is possible to switch from one database engine to another simply by changing the value in the CONFIG.INC file.</p>

<p>This class is based on the ideas outlined in <a href="http://www.tonymarston.net/php-mysql/databaseobjects.html">Using PHP Objects to access your Database Tables (Part 1)</a> and <a href="http://www.tonymarston.net/php-mysql/databaseobjects2.html">(Part 2)</a>. Some of the methods it contains are as follows:</p>

<ul>
<li><b>getData ($dbname, $tablename, $where)</b> - will retrieve any number of records from the database using a SELECT statement which is constructed as required. The result is an associative array of 'name=value' pairs indexed by row number. There are pagination options which break down large volumes of data into separate pages for display purposes.</li>

<li><b>insertRecord ($dbname, $tablename, $fieldarray)</b> - will insert a single row using the contents of <code>$fieldarray</code> (usually the <code>$_POST</code> array). A check is made before the INSERT to ensure that the primary key and any candidate keys are currently unused.</li>

<li><b>updateRecord ($dbname, $tablename, $newarray, $oldarray)</b> - will update a single row using the contents of <code>$newarray</code> (usually the <code>$_POST</code> array). This is first compared with <code>$oldarray</code> (the current database values) so that only those fields which have changed are included in the DML statement. The identity of the primary key for use in the WHERE clause is extracted using the contents of the <code><a href="http://www.tonymarston.net/php-mysql/data-dictionary.html#$fieldspec">$fieldspec</a></code> array. If any candidate key has changed it is first checked for uniqueness.</li>

<li><b>deleteRecord ($dbname, $tablename, $fieldarray)</b> - will delete a single row using the contents of <code>$fieldarray</code>. The identity of the primary key for use in the WHERE clause is extracted using the contents of the <code><a href="http://www.tonymarston.net/php-mysql/data-dictionary.html#$fieldspec">$fieldspec</a></code> array.</li>
</ul>

<p>Note that within a single transaction it is possible to access tables in more than one database and through more than one database engine.</p>

<h3><a name="view.object">View Object</a></h3>

<p>This is item (7) in <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#figure5">Figure 5</a>.</p>

<p>It uses as its input the contents of the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#screen.structure">screen structure script</a> and all the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#table.class">database table</a> objects which were accessed by the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#controller.script">controller</a> script.

</p><p>The <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#screen.structure">screen structure script</a> identifies which <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#xsl.stylesheet">XSL stylesheet</a> to use for the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#html.output">HTML output</a>, and a list of field names which need to be displayed in the data area.</p>

<p>The processing steps are as follows:</p>

<ul>
<li>Create an <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#xml.file">XML document</a> which will contain all the data from the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#table.class">database table</a> objects.</li>
<li>Add to this document the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#screen.structure.xml">structure</a> details from the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#screen.structure">screen structure script</a>.</li>
<li>Add to this document all the data for the <a href="http://www.tonymarston.net/php-mysql/dialog-types.html#menu-bar">menu bar</a>, <a href="http://www.tonymarston.net/php-mysql/dialog-types.html#title-bar">title bar</a>, <a href="http://www.tonymarston.net/php-mysql/dialog-types.html#navigation-bar">navigation bar</a>, <a href="http://www.tonymarston.net/php-mysql/dialog-types.html#action-bar">action bar</a>, <a href="http://www.tonymarston.net/php-mysql/dialog-types.html#pagination">pagination</a> and <a href="http://www.tonymarston.net/php-mysql/dialog-types.html#scrolling">scrolling</a> areas.</li>
<li>Perform an <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#xsl.transformation">XSL transformation</a> using the constructed <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#xml.file">XML document</a> and specified <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#xsl.stylesheet">XSL stylesheet</a>. This will usually be one of the generic stylesheets, although it is possible to create a custom stylesheet for particular circumstances. The result of this transformation will be the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#html.output">HTML output</a>.</li>
</ul>

<p>The <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#html.output">HTML output</a> is the text file which is sent back to the client's web browser. This is rendered into a viewable page with the assistance of one or more <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#css.files">CSS files</a> which are the recommended way of specifying a standard <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#style">style</a> in a group of HTML documents.</p>

<p>There are different view objects for creating the output in different formats, such as <a href="http://www.tonymarston.net/php-mysql/output-to-pdf.html">PDF</a> or CSV.</p>

<h3><a name="screen.structure">Screen Structure scripts</a></h3>

<p>This is item (8) in <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#figure5">Figure 5</a>.</p>

<p>These are simple scripts which do nothing but identify the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#view">view</a> or <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#structure-behaviour-content">content</a> for the output screen. Each one identifies the name of an <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#xsl.stylesheet">XSL stylesheet</a> and a list of table names, field names and field labels that will be used during the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#xsl.transformation">XSL transformation process</a> to produce the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#html.output">HTML output</a>.</p>

<p>The default script for a transaction is automatically created when that transaction is <a href="http://www.tonymarston.net/php-mysql/data-dictionary.html#generate.scripts">generated</a> from the <a href="http://www.tonymarston.net/php-mysql/data-dictionary.html">Data Dictionary</a>.</p>

<p>Sample scripts for each pattern can be found in the <b>/radicore/default/screens/en/</b> directory with the name <b>&lt;pattern&gt;.screen.inc</b>.</p>

<p>Scripts for each <a href="http://www.tonymarston.net/php-mysql/menuguide/mnu_subsystem(upd1).html">subsystem</a> can be found in the <b>/radicore/&lt;subsystem&gt;/screens/&lt;language&gt;/</b> directory. The default value for <b>&lt;language&gt;</b> is 'en' (English), but other language codes can be used - refer to <a href="http://www.tonymarston.net/php-mysql/internationalisation.html">Internationalisation and the Radicore Development Infrastructure</a> for details.</p>

<p>Although the parent LIST screen in <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#figure7">Figure 7</a> will require its own Screen Structure file, all the CHILD screens can share the same one as they all use the same structure. The differences in how the fields are displayed for each of the child components is handled by a combination of the <code>$mode</code> parameter within the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#controller.script">Transaction Pattern (Controller) script</a> (insert, update, delete, enquire) and individual <a href="http://www.tonymarston.net/php-mysql/domxml.html#a5">field attributes</a> within the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#xml.file">XML file</a>. These attributes can be specified within the <a href="http://www.tonymarston.net/php-mysql/data-dictionary.html#$fieldspec">$fieldspec</a> array for that <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#table.class">table class</a>, or can be supplied at runtime through <a href="http://www.tonymarston.net/php-mysql/databaseobjects2.html#custom.processing">custom code</a>.</p>

<p>Here is a sample file:</p>

<pre class="border">&lt;?php
<span class="comment">// this identifies which XSL stylesheet to use</span>
<span class="default">$structure</span>['<span class="string">xsl_file</span>'] = '<span class="string">std.detail1.xsl</span>';

<span class="comment">// this identifies which XML data is to go into which XSL zone</span>
<span class="default">$structure</span>['<span class="string">tables</span>']['<span class="string">main</span>'] = '<span class="string">person</span>';

<span class="comment">// this specifies the width of each column</span>
<span class="default">$structure</span>['<span class="string">main</span>']['<span class="string">columns</span>'][] = array('<span class="string">width</span>' =&gt; <span class="string">150</span>);
<span class="default">$structure</span>['<span class="string">main</span>']['<span class="string">columns</span>'][] = array('<span class="string">width</span>' =&gt; '<span class="string">*</span>');

<span class="comment">// the following may also be used </span>
<span class="default">$structure</span>['<span class="string">main</span>']['<span class="string">columns</span>'][] = array('<span class="string">class</span>' =&gt; '<span class="string">classname</span>');

<span class="comment">// this identifies the label and field which is to be displayed in each row</span>
<span class="default">$structure</span>['<span class="string">main</span>']['<span class="string">fields</span>'][] = array('<span class="string">person_id</span>' =&gt; '<span class="string">ID</span>');
<span class="default">$structure</span>['<span class="string">main</span>']['<span class="string">fields</span>'][] = array('<span class="string">first_name</span>' =&gt; '<span class="string">First Name</span>');
<span class="default">$structure</span>['<span class="string">main</span>']['<span class="string">fields</span>'][] = array('<span class="string">last_name</span>' =&gt; '<span class="string">Last Name</span>');
<span class="default">$structure</span>['<span class="string">main</span>']['<span class="string">fields</span>'][] = array('<span class="string">initials</span>' =&gt; '<span class="string">Initials</span>');
<span class="default">$structure</span>['<span class="string">main</span>']['<span class="string">fields</span>'][] = array('<span class="string">nat_ins_no</span>' =&gt; '<span class="string">Nat. Ins. No.</span>');
<span class="default">$structure</span>['<span class="string">main</span>']['<span class="string">fields</span>'][] = array('<span class="string">pers_type_id</span>' =&gt; '<span class="string">Person Type</span>');
<span class="default">$structure</span>['<span class="string">main</span>']['<span class="string">fields</span>'][] = array('<span class="string">star_sign</span>' =&gt; '<span class="string">Star Sign</span>');
<span class="default">$structure</span>['<span class="string">main</span>']['<span class="string">fields</span>'][] = array('<span class="string">email_addr</span>' =&gt; '<span class="string">E-mail</span>');
<span class="default">$structure</span>['<span class="string">main</span>']['<span class="string">fields</span>'][] = array('<span class="string">value1</span>' =&gt; '<span class="string">Value 1</span>');
<span class="default">$structure</span>['<span class="string">main</span>']['<span class="string">fields</span>'][] = array('<span class="string">value2</span>' =&gt; '<span class="string">Value 2</span>');
<span class="default">$structure</span>['<span class="string">main</span>']['<span class="string">fields</span>'][] = array('<span class="string">start_date</span>' =&gt; '<span class="string">Start Date</span>');
<span class="default">$structure</span>['<span class="string">main</span>']['<span class="string">fields</span>'][] = array('<span class="string">end_date</span>' =&gt; '<span class="string">End Date</span>');
<span class="default">$structure</span>['<span class="string">main</span>']['<span class="string">fields</span>'][] = array('<span class="string">selected</span>' =&gt; '<span class="string">Selected</span>');
?&gt;
</pre>

<p>In this example there is a single data zone called <b>main</b> which is linked with an object called <b>person</b>. Some screens have two or more zones which are linked to different objects. At runtime the fields will be extracted from each object and displayed in the relevant zone. Note that a field must exist both within the object and within the screen structure file in order for it to be displayed.</p>

<a name="screen.structure.xml"></a>
<p>The name of this file is provided by the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#component.script">Component</a> script in the <code>$screen</code> variable. It is read in by the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#view.object">view object</a> and its contents are added to the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#xml.file">XML file</a> to appear something like this:</p>

<pre class="border">&lt;root&gt;
  ......
  &lt;structure&gt;
    &lt;main id="<span class="string">person</span>"&gt;
      &lt;columns&gt;
        &lt;column width="<span class="string">150</span>"/&gt;
        &lt;column width="<span class="string">*</span>"/&gt;
      &lt;/columns&gt;
      &lt;row&gt;
        &lt;cell label=<span class="string">"ID"</span>/&gt;
        &lt;cell field=<span class="string">"person_id"</span> /&gt;
      &lt;/row&gt;
      &lt;row&gt;
        &lt;cell label=<span class="string">"First Name"</span>/&gt;
        &lt;cell field=<span class="string">"first_name"</span>/&gt;
      &lt;/row&gt;
      &lt;row&gt;
        &lt;cell label=<span class="string">"Last Name"</span>/&gt;
        &lt;cell field=<span class="string">"last_name"</span>/&gt;
      &lt;/row&gt;
      &lt;row&gt;
        &lt;cell label=<span class="string">"Initials"</span>/&gt;
        &lt;cell field=<span class="string">"initials"</span>/&gt;
      &lt;/row&gt;
      
      ....

      &lt;row&gt;
        &lt;cell label=<span class="string">"Start Date"</span>/&gt;
        &lt;cell field=<span class="string">"start_date"</span>/&gt;
      &lt;/row&gt;
      &lt;row&gt;
        &lt;cell label=<span class="string">"End Date"</span>/&gt;
        &lt;cell field=<span class="string">"end_date"</span>/&gt;
      &lt;/row&gt;
    &lt;/main&gt;
  &lt;/structure&gt;
&lt;/root&gt;
</pre>

<p>Several <a href="http://www.tonymarston.net/php-mysql/dialog-types.html#data-area">different layouts</a> are now available for displaying user data. For more details on how these can be specified please refer to <a href="http://www.tonymarston.net/php-mysql/model-view-controller.html#xsl-structure">XSL Structure files</a> in <a href="http://www.tonymarston.net/php-mysql/model-view-controller.html">The Model-View-Controller (MVC) Design Pattern for PHP</a>.</p>

<h3><a name="xml.file">XML files</a></h3>

<p>This is item (9) in <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#figure5">Figure 5</a>.</p>

<p><a href="http://www.w3.org/XML/">XML (Extensible Markup Language)</a> is a simple but flexible text format. It is based on an open standard which is maintained by the <a href="http://www.w3.org/">World Wide Web Consortium</a>. It is used in this infrastructure to provide the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#xsl.transformation">XSL transformation</a> process with all the data it needs to produce the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#html.output">HTML output</a>.</p>

<p>The XML file is generated automatically at runtime by the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#view.object">view object</a>. The technique which is used to create this file in PHP 4 is described in <a href="http://www.tonymarston.net/php-mysql/domxml.html">Using PHP 4's DOM XML functions to create XML files from SQL data</a>. For PHP 5 refer to <a href="http://www.tonymarston.net/php-mysql/dom.html">Using PHP 5's DOM functions to create XML files from SQL data</a> instead.</p>

<p>Each XML file can contain any of the following data:</p>

<ul class="compress">
<li>Values from any number of <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#table.class">database table</a> objects. These will use the table names and field names obtained from the database.</li>
<li>Each field may also have <a href="http://www.tonymarston.net/php-mysql/domxml.html#a5">attributes</a> which indicate how the field should be displayed, or to hold an error message.</li>
<li>A list of table names, field names and field labels obtained from the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#screen.structure">Screen Structure script</a>. For forms of type <a href="http://www.tonymarston.net/php-mysql/dialog-types.html#list">LIST</a> this will also provide the <a href="http://www.tonymarston.net/php-mysql/dialog-types.html#column-headings">column headings</a>.</li>
<li>Data to construct the <a href="http://www.tonymarston.net/php-mysql/dialog-types.html#menu-bar">Menu bar</a>.</li>
<li>Data to construct the <a href="http://www.tonymarston.net/php-mysql/dialog-types.html#navigation-bar">Navigation bar</a>.</li>
<li>Data to construct the <a href="http://www.tonymarston.net/php-mysql/dialog-types.html#pagination">Pagination</a> or <a href="http://www.tonymarston.net/php-mysql/dialog-types.html#scrolling">Scrolling</a> areas.</li>
<li>Data for the <a href="http://www.tonymarston.net/php-mysql/dialog-types.html#action-bar">Action bar</a>.</li>
<li>Data for the <a href="http://www.tonymarston.net/php-mysql/dialog-types.html#message-area">Message area</a>.</li>
<li>Data for any lookup (picklist) fields such as dropdown lists or radio groups.</li>
</ul>

<h3><a name="xsl.stylesheet">XSL Stylesheets</a></h3>

<p>This is item (10) in <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#figure5">Figure 5</a>.</p>

<p>Each component requires an <a href="http://www.w3.org/Style/XSL/">XSL stylesheet</a> in order to transform the data in the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#xml.file">XML file</a> into <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#html.output">HTML output</a>. In an earlier version of this infrastructure I used different <a href="http://www.tonymarston.net/xml-xsl/xml-and-xsl.html#s3.2">stylesheets</a> for each database table which had the table names, field names and field labels all hard-coded, but I have subsequently found a way to use a smaller number of generic stylesheets. Instead of having the field details hard-coded within the stylesheet I am now able to extract that information from within the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#xml.file">XML file</a> using information supplied in a <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#screen.structure">Screen Structure script</a>. This is is documented in <a href="http://www.tonymarston.net/xml-xsl/reusable-xsl.html">Reusable XSL Stylesheets and Templates</a>.</p>

<p>Although my whole web application uses fewer than ten generic stylesheets there is still some code which is needed in more than one stylesheet. This code has been extracted and placed in a library of XSL templates which can be incorporated into any stylesheet at runtime by means of an <code>&lt;xsl:include&gt;</code> command. This is, in effect, a <a href="http://www.tonymarston.net/xml-xsl/xml-and-xsl.html#xsl.include.files">library of standard XSL subroutines</a>.</p>

<p>Using the components in <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#figure7">Figure 7</a> as an example I would use a generic <a href="http://www.tonymarston.net/xml-xsl/reusable-xsl.html#std.list1.xsl">LIST stylesheet</a> for the parent component and a generic <a href="http://www.tonymarston.net/xml-xsl/reusable-xsl.html#std.detail1.xsl">DETAIL stylesheet</a> for all the child components. Variations in how the individual fields are displayed within the various child components is handled primarily by the <code>$mode</code> variable which is passed as a parameter during the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#xsl.transformation">XSL transformation process</a>. This is used as follows:</p>

<ul class="compress">
<li>If <code>$mode</code> = 'input' or 'search' then all fields are editable.</li>
<li>If <code>$mode</code> = 'read' or 'delete' then all fields are non-editable.</li>
<li>if <code>$mode</code> = 'update' then primary key fields are non-editable.</li>
<li>If <code>$mode</code> = 'search' then any boolean fields are given a third option to emulate a tri-state checkbox (yes, no, undefined).</li>
</ul>

<p>In addition to the <code>$mode</code> parameter the handling of individual fields can be affected by specific <a href="http://www.tonymarston.net/php-mysql/domxml.html#a5">attributes</a> in the XML file. These can either be set into the <a href="http://www.tonymarston.net/php-mysql/data-dictionary.html#$fieldspec">$fieldspec</a> array or altered at runtime using <a href="http://www.tonymarston.net/php-mysql/databaseobjects2.html#custom.processing">custom code</a>.</p>

<ul class="compress">
<li>The <code>noedit</code> attribute will make the field non-editable.</li>
<li>The <code>nodisplay</code> attribute will make the field invisible.</li>
</ul>

<p>The type of HTML control (textbox, dropdown, radio group, etc) to be used for each field in the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#html.output">HTML output</a> is completely dynamic in nature. This is a 3 stage process:</p>

<ul>
<li>The default <a href="http://www.tonymarston.net/php-mysql/data-dictionary.html#html.control">HTML control</a> is initially defined within the <a href="http://www.tonymarston.net/php-mysql/data-dictionary.html#$fieldspec">$fieldspec</a> array, but this can be changed at runtime with <a href="http://www.tonymarston.net/php-mysql/databaseobjects2.html#custom.processing">custom code</a>.</li>
<li>As the contents of each database object is written out to the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#xml.file">XML file</a> by the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#controller.script">Transaction Pattern (Controller) script</a> various details from the <a href="http://www.tonymarston.net/php-mysql/data-dictionary.html#$fieldspec">$fieldspec</a> array are included with each field as <a href="http://www.tonymarston.net/php-mysql/domxml.html#a5">XML attributes</a>.</li>
<li>During the <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#xsl.transformation">XSL transformation process</a> a standard XSL template will use the field attributes to build the HTML control to the supplied specifications.</li>
</ul>

<h3><a name="xsl.transformation">XSL Transformation process</a></h3>

<p>This is item (11) in <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#figure5">Figure 5</a>.</p>

<p>This process will take the contents of an <a href="http://www.w3.org/XML/">XML document</a> and transform it to another document (in this case an <a href="http://www.w3.org/MarkUp/">HTML document</a>) using rules contained within an <a href="http://www.w3.org/TR/xslt">XSL stylesheet</a>. These are all open standards which are supervised by the <a href="http://www.w3.org/">World Wide Web Consortium</a>.</p>

<p>It is possible to send both the XML and XSL files to the client and have the transformation performed within the client's browser (<a href="http://www.tonymarston.net/php-mysql/client-side-xslt.html">client-side transformation</a>), but this is unreliable due to the different levels (sometimes non-existent) of XML/XSL support in different browsers. It is much safer to perform the transformation in a single place (the web server) where the software is under the control of the web developer. This is known as a server-side transformation.</p>

<p>The technique which I use to perform XSL transformations in PHP 4 is described in <a href="http://www.tonymarston.net/php-mysql/sablotron.html">Using PHP 4's Sablotron extension to perform XSL Transformations</a>. For PHP 5 refer to <a href="http://www.tonymarston.net/php-mysql/xsl.html">Using PHP 5's XSL extension to perform XSL Transformations</a> instead.</p>

<h3><a name="html.output">HTML output</a></h3>

<p>This is item (12) in <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#figure5">Figure 5</a>.</p>

<p>This is the document which is sent back to the client's browser is response to the request. Its content should conform to the <a href="http://www.w3.org/MarkUp/">(X)HTML</a> specification which is supervised by the <a href="http://www.w3.org/">World Wide Web Consortium</a>.</p>

<p>In an effort to make my output viewable on as many web browsers as possible I stick to the following guidelines:</p>

<ul class="compress">
<li>All output is <a href="http://www.w3.org/MarkUp/#recommendations">XHTML 1.0 Strict</a> which is structurally clean and free of any style details. All style specifications (fonts, colours and layout) are held within separate <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#css.files">CSS files</a>.</li>
<li>There is no javascript (some users have javascript disabled).</li>
<li>There are no third party controls or plugins (ActiveX or Flash).</li>
<li>There are no proprietary extensions.</li>
</ul>

<p>HTML documents can be validated by the <a href="http://validator.w3.org/">W3C Markup Validation Service</a>.</p>

<h3><a name="css.files">CSS files</a></h3>

<p>This is item (13) in <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#figure5">Figure 5</a>.</p>

<p>These are <a href="http://www.w3.org/Style/CSS/">Cascading Style Sheets</a> which hold all the styling information (fonts, colours, sizes, positioning, etc) for all <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#html.output">HTML documents</a> produced by the application. The tags within each HTML document refer to a style by a class name, and the specifications for each of these classes is held within a CSS file. In this way it becomes possible to change the style specifications for any tag in all documents simply by changing the specifications within a single CSS file.</p>

<p>The following CSS files are available:</p>

<ul>
<li>global - a selection of files exist within the CSS subdirectory which set the style for the entire application. It is possible to choose any one of these using the style/theme option in the <a href="http://www.tonymarston.net/php-mysql/menuguide/mnu_session(upd3).html">Update Session data</a> screen. Additional CSS files may be created and copied into this subdirectory, in which case they will automatically become available for selection.</li>
<li>local - if it is required to change the global setting for a CSS element, or to create a new CSS element within a single subsystem, then instead of creating a complete global CSS file it is possible to insert these local modifications into a local CSS file called 'style_custom.css', which exists in every subdirectory. When the HTML document is rendered it will use the contents of both the global and local CSS files. If any setting exists in both files then the local setting will override the global setting.</li>
</ul>

<p>CSS files can be validated using the <a href="http://jigsaw.w3.org/css-validator/">W3C CSS Validation Service</a>.</p>

<h3><a name="audit.class">AUDIT class</a></h3>

<p>This is item (14) in <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#figure5">Figure 5</a>.</p>

<p>This class is responsible for detecting all database changes (INSERTs, UPDATEs and DELETEs) and recording them in a separate 'audit' database so that they can be reviewed using online enquiry screens. This is documented in <a href="http://www.tonymarston.net/php-mysql/auditlog.html">Creating an Audit Log with an online viewing facility</a>.</p>

<p>The only additional code required in any <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#table.class">database table class</a> is the setting of a class variable called <code>$audit_logging</code>. By default this is TRUE (the table will be logged) but it can be set to FALSE to disable logging.</p>

<h3><a name="workflow.engine">Workflow Engine</a></h3>

<p>This is item (15) in <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#figure5">Figure 5</a>.</p>

<p>Sometimes when a particular task is performed, such as 'Take Customer Order', this has to be followed by a series of other tasks in a particular sequence such as 'Charge Customer', 'Pack Order' and 'Ship Order'. Without a Workflow Engine these subsequent tasks must be selected and processed manually, which is where mistakes and inefficiencies can arise.</p>

<p>The purpose of a Workflow System is to manage these tasks in a controlled fashion. This system should have the following components:</p>

<ul>
<li>A method whereby different Workflow processes can be defined. This must identify the triggering task and the sequence of subsequent tasks.</li>
<li>A mechanism which automatically creates a new workflow case when a triggering task is processed, then progresses that case through its various stages.</li>
<li>A method whereby outstanding tasks (workitems) in workflow cases which require human intervention appear in a list which prompts the relevant users that intervention is required. A task should be activated simply by clicking on its entry in this list.</li>
<li>A method whereby the status of any individual workflow case can be reviewed.</li>
</ul>

<p>The Workflow Engine which I have created as an extension to this development infrastructure is documented in <a href="http://www.tonymarston.net/php-mysql/workflow.html" target="_top">An activity based Workflow Engine for PHP</a>. The engine is activated from within my <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#generic.table.class">generic table class</a> therefore no additional programmer coding is required.</p>

<hr>

<h2><a name="reusability">Levels of Reusability</a></h2>

<p>The single aspect of any development infrastructure which enables Rapid Application Development (RAD) is the volume of reusable code that it contains. Reusable code in the form of a library of standard modules provides the following advantages:</p>

<ul class="compress">
<li>The library modules contain code which has already been written to provide certain functionality, therefore it is not necessary to waste more time in writing more code to provide the same functionality.</li>
<li>The library modules contain code which has already been tested, therefore this cuts down the testing phase of new components which use these modules.</li>
<li>By using standard library modules for standard tasks the developer does not have to waste time in reinventing the wheel (and possibly creating a square wheel).</li>
<li>By using standard code to provide certain functionality it means that the same functionality will be provided in a consistent manner across multiple components. This will be less confusing to the user.</li>
<li>By using standard library modules it becomes possible to make a change in a single module and have that change immediately incorporated into every component that references that module.</li>
</ul>

<p>Although the infrastructure described within this document contains a large number of components it should be pointed out that the majority of them do not require any additional effort on the part of the developer. These are:</p>

<ul class="compress">
<li><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#controller.script">Transaction Pattern (Controller) scripts</a></li>
<li><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#generic.table.class">Generic table class</a></li>
<li><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#validation.class">Validation class</a></li>
<li><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#dml.class">DML class</a></li>
<li><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#view.object">View object</a></li>
<li><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#xsl.stylesheet">XSL Stylesheets</a></li>
<li><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#xsl.transformation">XSL Transformation process</a> (server-side, built into PHP, or <a href="http://www.tonymarston.net/php-mysql/client-side-xslt.html">client-side</a> if supported by the client browser)</li>
<li><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#css.files">CSS files</a></li>
<li><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#audit.class">Audit logging</a></li>
<li><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#workflow.engine">Workflow Engine</a></li>
</ul>

<p>The following components are generated automatically at runtime and do not require any programmer effort:</p>

<ul class="compress">
<li><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#xml.file">XML files</a></li>
<li><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#html.output">HTML output</a></li>
</ul>

<p>This leaves the following components, which are originally generated by the framework, for the developer to work on:</p>

<ul class="compress">
<li><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#table.class">Database Table (Model) classes</a> (can be reused by any component which needs to access that database table).</li>
<li><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#screen.structure">Screen Structure scripts</a> (the scripts for 'detail' screens can be used by the SEARCH, INSERT, UPDATE, DELETE and ENQUIRE components for that database table).</li>
<li><a href="http://www.tonymarston.net/php-mysql/infrastructure.html#component.script">Component scripts</a> (cannot be reused because each one is unique).</li>
</ul>

<p>An idea of the amount of reusability can be shown in <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#figure10">figure 10</a>:</p>

<div class="center">
<p><a name="figure10">Figure 10</a> - Levels of Reusability</p>
<img alt="infrastructure-10 (9K)" src="./A Development Infrastructure for PHP_files/infrastructure-10.png" height="560" width="627">
</div>

<p>This shows the following:</p>

<ul class="compress">
<li>A business entity requires one <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#table.class">database table class</a> which is shared by six transactions.</li>
<li>Five of these transactions share the same <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#screen.structure">screen definition</a>.</li>
<li>All LIST transactions share the same LIST <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#controller.script">controller scripts</a>, all INSERT transactions share the same INERT <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#controller.script">controller scripts</a>, etc.</li>
<li>All LIST screens share the same <a href="http://www.tonymarston.net/xml-xsl/reusable-xsl.html#std.list1.xsl">list.xsl stylesheet</a>.</li>
<li>All DETAIL (search, insert, update, delete and enquire) screens share the same <a href="http://www.tonymarston.net/xml-xsl/reusable-xsl.html#std.detail1.xsl">detail.xsl stylesheet</a>.</li>
</ul>

<p>I have spent 20+ years working for software houses where the task has been to develop many different applications for many different customers in a swift and cost-effective manner. To be truly reusable an infrastructure should not only work for different components within the same application but for different applications entirely. This offers two advantages:</p>

<ul>
<li>It avoids the necessity of constructing a new infrastructure for each new application.</li>
<li>It avoids the non-productive time in learning a new infrastructure when developers switch from one application to another.</li>
</ul>

<p>I have witnessed at first hand the advantages of being able to use such infrastructures as I have used them with two entirely different languages - <a href="http://www.tonymarston.co.uk/cobol/">COBOL</a> and <a href="http://www.tonymarston.net/uniface/">UNIFACE</a>. As I was personally responsible for creating those two infrastructures I had all the relevant experience to create a new one in <a href="http://www.tonymarston.co.uk/php-mysql/">PHP</a>.</p>

<hr>

<h2><a name="extensions">Extending this Infrastructure</a></h2>

<p>Having an infrastructure with which you can build applications is one thing, but in my long experience I have also found it useful to build utility components which may be of benefit to those applications. This type of component is not specific to any particular application, but may be used in conjunction with any number of different applications. Amongst those I have built are:</p>

<ul>
<li>A Role Based Access Control (RBAC) system (also known as a Menu and Security system) which can act as the front end for any application. It allows tasks to be defined in a hierarchy of menus and allows user access to individual tasks to be granted or denied to individual user roles. This is documented in:
  <ul>
  <li><a href="http://www.tonymarston.net/php-mysql/role-based-access-control.html">A Role-Based Access Control (RBAC) system for PHP</a></li>
  <li><a href="http://www.tonymarston.net/php-mysql/menuguide/index.html">User Guide to the Menu and Security (RBAC) System</a></li>
  </ul>
</li>
<li>An audit facility which records all changes made to application databases in a separate 'audit' database so that they may be reviewed using online enquiry screens. This is documented in:
  <ul>
  <li><a href="http://www.tonymarston.net/php-mysql/auditlog.html">Creating an Audit Log with an online viewing facility</a>.</li>
  </ul>
</li>
<li>An activity based Workflow Engine for PHP which is built around Petri Nets. This allows workflow processes to be defined, creates workflow cases when the triggering event is fired, and adds workitems to user menu screens. This is documented in:
  <ul>
  <li><a href="http://www.tonymarston.net/php-mysql/workflow.html">An activity based Workflow Engine for PHP</a></li>
  </ul>
</li>
<li>A Data Dictionary which allows details of an application database to be imported, modified and exported for use in PHP scripts, thus saving the need to create these details by hand. This is documented in:
  <ul>
  <li><a href="http://www.tonymarston.net/php-mysql/data-dictionary.html" target="_top">A Data Dictionary for PHP Applications</a></li>
  </ul>
</li>
<li>The capability to allow program-generated text (error messages, screen titles, field labels, button text, etc) to be displayed in more than one language. This is documented in:
  <ul>
  <li><a href="http://www.tonymarston.net/php-mysql/internationalisation.html">Internationalisation and the Radicore Development Infrastructure</a></li>
  </ul>
</li>
<li>A wide-ranging set of security features. This is documented in:
  <ul>
  <li><a href="http://www.tonymarston.net/php-mysql/radicore-security.html">The RADICORE Security Model</a></li>
  </ul>
</li>
</ul>

<hr>

<h2><a name="references">References</a></h2>

<ul class="compress">
<li><a href="http://www.tonymarston.net/php-mysql/databaseobjects.html">Using PHP Objects to access your Database Tables (Part 1)</a></li>
<li><a href="http://www.tonymarston.net/php-mysql/databaseobjects2.html">Using PHP Objects to access your Database Tables (Part 2)</a></li>
<li><a href="http://www.tonymarston.net/php-mysql/good-bad-oop.html">What is/is not considered to be good OO programming</a></li>
<li><a href="http://www.tonymarston.net/php-mysql/hero-or-heretic.html">In the world of OOP am I Hero or Heretic?</a></li>
<li><a href="http://www.tonymarston.net/xml-xsl/xml-and-xsl.html">Generating dynamic web pages using XSL and XML</a></li>
<li><a href="http://www.tonymarston.net/xml-xsl/reusable-xsl.html">Reusable XSL Stylesheets and Templates</a></li>
<li><a href="http://www.tonymarston.net/php-mysql/domxml.html">Using PHP 4's DOM XML functions to create XML files from SQL data</a></li>
<li><a href="http://www.tonymarston.net/php-mysql/sablotron.html">Using PHP 4's Sablotron extension to perform XSL Transformations</a></li>
<li><a href="http://www.tonymarston.net/php-mysql/dom.html">Using PHP 5's DOM functions to create XML files from SQL data</a></li>
<li><a href="http://www.tonymarston.net/php-mysql/xsl.html">Using PHP 5's XSL functions to perform XSL Transformations</a></li>
<li><a href="http://www.tonymarston.net/php-mysql/dialog-types.html">Transaction Patterns for Web Applications</a></li>
<li><a href="http://www.tonymarston.net/php-mysql/uml-diagrams.html" target="_top">UML diagrams for the Radicore Development Infrastructure</a></li>
<li><a href="http://www.tonymarston.net/php-mysql/errorhandler.html">Customising the PHP error handler</a></li>
<li><a href="http://www.tonymarston.net/uniface/largevssmall.html">Component Design - Large and Complex vs. Small and Simple</a></li>
<li><a href="http://www.tonymarston.net/php-mysql/sample-application.html">A Sample PHP Application</a></li>
<li><a href="http://www.tonymarston.net/php-mysql/model-view-controller.html">The Model-View-Controller (MVC) Design Pattern for PHP</a></li>
<li><a href="http://www.tonymarston.net/php-mysql/infrastructure-faq.html">FAQ on the Radicore Development Infrastructure</a></li>
<li><a href="http://www.tonymarston.net/php-mysql/role-based-access-control.html">A Role-Based Access Control (RBAC) system for PHP</a></li>
<li><a href="http://www.tonymarston.net/php-mysql/menuguide/index.html">User Guide to the Menu and Security (RBAC) System</a></li>
<li><a href="http://www.tonymarston.net/php-mysql/auditlog.html">Creating an Audit Log with an online viewing facility</a></li>
<li><a href="http://www.tonymarston.net/php-mysql/workflow.html">An activity based Workflow Engine for PHP</a></li>
<li><a href="http://www.tonymarston.net/php-mysql/data-dictionary.html" target="_top">A Data Dictionary for PHP Applications</a></li>
<li><a href="http://www.tonymarston.net/php-mysql/internationalisation.html">Internationalisation and the Radicore Development Infrastructure</a></li>
</ul>

<hr>
<p> <span class="sig">Tony Marston</span><br>
2nd August 2003<br>
<br><a href="http://www.tonymarston.net/">http://www.tonymarston.net</a>
<br><a href="http://www.radicore.org/">http://www.radicore.org</a></p>

<p><a name="history">Amendment history:</a></p>
<div style="margin-left: 1em; margin-right: 1em; ">

<table>
<colgroup valign="top">
  <col width="150">
	<col>
</colgroup>

<tbody><tr>
	<td><a name="2012-04-30">30 April 2012</a></td>
	<td>Added a description for <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#view.object">View object</a>.</td>
</tr>

<tr>
	<td><a name="2005-07-15">15 July 2005</a></td>
	<td>Added a reference to a new article entitled <a href="http://www.tonymarston.net/php-mysql/internationalisation.html">Internationalisation and the Radicore Development Infrastructure</a>.</td>
</tr>

<tr>
	<td><a name="2005-06-21">21 June 2005</a></td>
	<td>Amended <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#screen.structure">Screen Structure scripts</a> to show the new layouts caused by the provision of more flexible options.</td>
</tr>

<tr>
	<td><a name="2005-06-17">17 June 2005</a></td>
	<td>Added a reference to a new article entitled <a href="http://www.tonymarston.net/php-mysql/data-dictionary.html">A Data Dictionary for PHP Applications</a>.</td>
</tr>

<tr>
	<td><a name="2004-09-16">16 Sep 2004</a></td>
  <td>Added a reference to a new article entitled <a href="http://www.tonymarston.net/php-mysql/workflow.html">An activity based Workflow Engine for PHP</a>.</td>
</tr>

<tr>
	<td><a name="2004-09-10">10 Sep 2004</a></td>
	<td>Added section <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#extensions">Extending this Infrastructure</a>.</td>
</tr>

<tr>
	<td><a name="2004-08-10">10 Aug 2004</a></td>
	<td>Added better descriptions for the individual components. Moved all the <a href="http://www.tonymarston.net/php-mysql/infrastructure-faq.html">Frequently Asked Questions</a> to a separate document.</td>
</tr>

<tr>
	<td><a name="2004-06-03">03 June 2004</a></td>
	<td>Added a section on <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#style">Style</a> which explains the advantages of using Cascading Style Sheets.</td>
</tr>

<tr>
	<td><a name="2004-05-02">02 May 2004</a></td>
	<td>Added a reference to <a href="http://www.tonymarston.net/php-mysql/model-view-controller.html">The Model-View-Controller (MVC) Design Pattern for PHP</a>.</td>
</tr>

<tr>
	<td><a name="2004-04-28">28 Apr 2004</a></td>
  <td>Added a reference to <a href="http://www.tonymarston.net/xml-xsl/reusable-xsl.html">Reusable XSL Stylesheets and Templates</a> which describes a method which enables me to use a single generic stylesheet for many database tables instead of having a customised stylesheet for each individual database table.</td>
</tr>

<tr>
	<td><a name="2003-11-10">10 Nov 2003</a></td>
	<td>Created a sample application to demonstrate the techniques described in this document. This is described in <a href="http://www.tonymarston.net/php-mysql/sample-application.html">A Sample PHP Application</a>. The code can be run on my website <a href="http://www.tonymarston.net/sample/index.html">here</a>, or can be downloaded <a href="http://www.tonymarston.net/sample/sample-application.zip">here</a> and run locally.</td>
</tr>

<tr>
	<td><a name="2003-09-08">08 Sep 2003</a></td>
	<td>Split my abstract database class again so that the code which performs generic validation (declarative checks) is now contained within its own class. Refer to <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#business.layer">Business layer</a> for details.</td>
</tr>

<tr>
	<td><a name="2003-08-31">31 Aug 2003</a></td>
	<td>Split my abstract database class into two so that the construction and execution of all DML statements is now contained within its own class. Refer to <a href="http://www.tonymarston.net/php-mysql/infrastructure.html#data.access.layer">Data Access layer</a> for details.</td>
</tr>

</tbody></table>
</div>

<p><img src="./A Development Infrastructure for PHP_files/counter.php" alt="counter" border="0"></p>



</body></html>